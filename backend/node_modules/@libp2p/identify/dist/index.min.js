(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PIdentify = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PIdentify=(()=>{var xu=Object.create;var yn=Object.defineProperty;var wu=Object.getOwnPropertyDescriptor;var Eu=Object.getOwnPropertyNames;var Su=Object.getPrototypeOf,vu=Object.prototype.hasOwnProperty;var Au=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),vt=(e,t)=>{for(var r in t)yn(e,r,{get:t[r],enumerable:!0})},Oi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Eu(t))!vu.call(e,o)&&o!==r&&yn(e,o,{get:()=>t[o],enumerable:!(n=wu(t,o))||n.enumerable});return e};var Iu=(e,t,r)=>(r=e!=null?xu(Su(e)):{},Oi(t||!e||!e.__esModule?yn(r,"default",{value:e,enumerable:!0}):r,e)),_u=e=>Oi(yn({},"__esModule",{value:!0}),e);var iu=Au(hn=>{(function(){var e,t,r,n,o,s,i,c;c=function(a){var u,d,l,f;return u=(a&255<<24)>>>24,d=(a&255<<16)>>>16,l=(a&65280)>>>8,f=a&255,[u,d,l,f].join(".")},i=function(a){var u,d,l,f,p,h;for(u=[],l=f=0;f<=3&&a.length!==0;l=++f){if(l>0){if(a[0]!==".")throw new Error("Invalid IP");a=a.substring(1)}h=t(a),p=h[0],d=h[1],a=a.substring(d),u.push(p)}if(a.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},r=function(a){return a.charCodeAt(0)},n=r("0"),s=r("a"),o=r("A"),t=function(a){var u,d,l,f,p;for(f=0,u=10,d="9",l=0,a.length>1&&a[l]==="0"&&(a[l+1]==="x"||a[l+1]==="X"?(l+=2,u=16):"0"<=a[l+1]&&a[l+1]<="9"&&(l++,u=8,d="7")),p=l;l<a.length;){if("0"<=a[l]&&a[l]<=d)f=f*u+(r(a[l])-n)>>>0;else if(u===16)if("a"<=a[l]&&a[l]<="f")f=f*u+(10+r(a[l])-s)>>>0;else if("A"<=a[l]&&a[l]<="F")f=f*u+(10+r(a[l])-o)>>>0;else break;else break;if(f>4294967295)throw new Error("too large");l++}if(l===p)throw new Error("empty octet");return[f,l]},e=(function(){function a(u,d){var l,f,p,h;if(typeof u!="string")throw new Error("Missing `net' parameter");if(d||(h=u.split("/",2),u=h[0],d=h[1]),d||(d=32),typeof d=="string"&&d.indexOf(".")>-1){try{this.maskLong=i(d)}catch(g){throw l=g,new Error("Invalid mask: "+d)}for(f=p=32;p>=0;f=--p)if(this.maskLong===4294967295<<32-f>>>0){this.bitmask=f;break}}else if(d||d===0)this.bitmask=parseInt(d,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(i(u)&this.maskLong)>>>0}catch(g){throw l=g,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+d);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return a.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new a(u)),u instanceof a?this.contains(u.base)&&this.contains(u.broadcast||u.last):(i(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},a.prototype.next=function(u){return u==null&&(u=1),new a(c(this.netLong+this.size*u),this.mask)},a.prototype.forEach=function(u){var d,l,f;for(f=i(this.first),l=i(this.last),d=0;f<=l;)u(c(f),f,d),d++,f++},a.prototype.toString=function(){return this.base+"/"+this.bitmask},a})(),hn.ip2long=i,hn.long2ip=c,hn.Netmask=e}).call(hn)});var lh={};vt(lh,{identify:()=>uh,identifyPush:()=>fh});var xo=Symbol.for("@libp2p/peer-id");var ct=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},$e=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var bn=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},gn=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}},xn=class extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}},Ut=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}};var De=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var wn=Symbol.for("@libp2p/service-capabilities"),mh=Symbol.for("@libp2p/service-dependencies");var Ao={};vt(Ao,{base58btc:()=>Q,base58flickr:()=>Lu});var Kh=new Uint8Array(0);function Li(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Qt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Ri(e){return new TextEncoder().encode(e)}function Ni(e){return new TextDecoder().decode(e)}function Cu(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,a=e.charAt(0),u=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var g=0,v=0,x=0,A=h.length;x!==A&&h[x]===0;)x++,g++;for(var E=(A-x)*d+1>>>0,P=new Uint8Array(E);x!==A;){for(var R=h[x],F=0,V=E-1;(R!==0||F<v)&&V!==-1;V--,F++)R+=256*P[V]>>>0,P[V]=R%c>>>0,R=R/c>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,x++}for(var N=E-v;N!==E&&P[N]===0;)N++;for(var w=a.repeat(g);N<E;++N)w+=e.charAt(P[N]);return w}function f(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var g=0;if(h[g]!==" "){for(var v=0,x=0;h[g]===a;)v++,g++;for(var A=(h.length-g)*u+1>>>0,E=new Uint8Array(A);h[g];){var P=r[h.charCodeAt(g)];if(P===255)return;for(var R=0,F=A-1;(P!==0||R<x)&&F!==-1;F--,R++)P+=c*E[F]>>>0,E[F]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");x=R,g++}if(h[g]!==" "){for(var V=A-x;V!==A&&E[V]===0;)V++;for(var N=new Uint8Array(v+(A-V)),w=v;V!==A;)N[w++]=E[V++];return N}}}function p(h){var g=f(h);if(g)return g;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var Bu=Cu,Du=Bu,Ki=Du;var wo=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Eo=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ki(this,t)}},So=class{decoders;constructor(t){this.decoders=t}or(t){return ki(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ki(e,t){return new So({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var vo=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new wo(t,r,n),this.decoder=new Eo(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Ge({name:e,prefix:t,encode:r,decode:n}){return new vo(e,t,r,n)}function ye({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Ki(r,e);return Ge({prefix:t,name:e,encode:n,decode:s=>Qt(o(s))})}function Pu(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,c=0,a=0;for(let u=0;u<o;++u){let d=t[e[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|d,i+=r,i>=8&&(i-=8,s[a++]=255&c>>i)}if(i>=r||(255&c<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Tu(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let a=0;a<e.length;++a)for(c=c<<8|e[a],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function Ou(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function rt({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=Ou(n);return Ge({prefix:t,name:e,encode(s){return Tu(s,n,r)},decode(s){return Pu(s,o,r,e)}})}var Q=ye({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lu=ye({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Io={};vt(Io,{base32:()=>be,base32hex:()=>Ku,base32hexpad:()=>Mu,base32hexpadupper:()=>Vu,base32hexupper:()=>ku,base32pad:()=>Nu,base32padupper:()=>Uu,base32upper:()=>Ru,base32z:()=>Fu});var be=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ru=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Nu=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uu=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ku=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ku=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mu=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vu=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fu=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _o={};vt(_o,{base36:()=>_r,base36upper:()=>qu});var _r=ye({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qu=ye({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Hu=Fi,Mi=128,zu=127,$u=~zu,Gu=Math.pow(2,31);function Fi(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Gu;)t[r++]=e&255|Mi,e/=128;for(;e&$u;)t[r++]=e&255|Mi,e>>>=7;return t[r]=e|0,Fi.bytes=r-n+1,t}var Zu=Co,Yu=128,Vi=127;function Co(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw Co.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Vi)<<o:(i&Vi)*Math.pow(2,o),o+=7}while(i>=Yu);return Co.bytes=s-n,r}var Wu=Math.pow(2,7),ju=Math.pow(2,14),Xu=Math.pow(2,21),Qu=Math.pow(2,28),Ju=Math.pow(2,35),tf=Math.pow(2,42),ef=Math.pow(2,49),rf=Math.pow(2,56),nf=Math.pow(2,63),of=function(e){return e<Wu?1:e<ju?2:e<Xu?3:e<Qu?4:e<Ju?5:e<tf?6:e<ef?7:e<rf?8:e<nf?9:10},sf={encode:Hu,decode:Zu,encodingLength:of},af=sf,Cr=af;function Br(e,t=0){return[Cr.decode(e,t),Cr.decode.bytes]}function Ze(e,t,r=0){return Cr.encode(e,t,r),t}function Ye(e){return Cr.encodingLength(e)}function $t(e,t){let r=t.byteLength,n=Ye(e),o=n+Ye(r),s=new Uint8Array(o+r);return Ze(e,s,0),Ze(r,s,n),s.set(t,o),new We(e,r,t,s)}function Dr(e){let t=Qt(e),[r,n]=Br(t),[o,s]=Br(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new We(r,o,i,t)}function qi(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Li(e.bytes,r.bytes)}}var We=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Hi(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return uf(r,Bo(e),t??Q.encoder);default:return ff(r,Bo(e),t??be.encoder)}}var zi=new WeakMap;function Bo(e){let t=zi.get(e);if(t==null){let r=new Map;return zi.set(e,r),r}return t}var it=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Pr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==lf)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=$t(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&qi(t.multihash,n.multihash)}toString(t){return Hi(this,t)}toJSON(){return{"/":Hi(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??$i(n,o,s.bytes))}else if(r[df]===!0){let{version:n,multihash:o,code:s}=r,i=Dr(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Pr)throw new Error(`Version 0 CID must use dag-pb (code: ${Pr}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=$i(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Pr,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Qt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new We(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[l,f]=Br(t.subarray(r));return r+=f,l},o=n(),s=Pr;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),a=n(),u=r+a,d=u-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:d,size:u}}static parse(t,r){let[n,o]=cf(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Bo(s).set(n,t),s}};function cf(e,t){switch(e[0]){case"Q":{let r=t??Q;return[Q.prefix,r.decode(`${Q.prefix}${e}`)]}case Q.prefix:{let r=t??Q;return[Q.prefix,r.decode(e)]}case be.prefix:{let r=t??be;return[be.prefix,r.decode(e)]}case _r.prefix:{let r=t??_r;return[_r.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function uf(e,t,r){let{prefix:n}=r;if(n!==Q.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function ff(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Pr=112,lf=18;function $i(e,t,r){let n=Ye(e),o=n+Ye(t),s=new Uint8Array(o+r.byteLength);return Ze(e,s,0),Ze(t,s,n),s.set(r,o),s}var df=Symbol.for("@ipld/js-cid/CID");var Do={};vt(Do,{identity:()=>Kt});var Gi=0,hf="identity",Zi=Qt;function pf(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return $t(Gi,Zi(e))}var Kt={code:Gi,name:hf,encode:Zi,digest:pf};function ut(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function ht(e=0){return new Uint8Array(e)}function At(e=0){return new Uint8Array(e)}function Jt(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=At(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var Wi=Symbol.for("@achingbrain/uint8arraylist");function Yi(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function Sn(e){return!!e?.[Wi]}var ot=class e{bufs;length;[Wi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(Sn(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(Sn(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Yi(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Yi(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(Sn(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Jt(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Jt(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let u=t>=c&&t<a,d=r>c&&r<=a;if(u&&d){if(t===c&&r===a){n.push(i);break}let l=t-c;n.push(i.subarray(l,l+(r-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(d){if(r===a){n.push(i);break}n.push(i.subarray(0,r-c));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!Sn(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let c=i,a=this.byteLength-n.byteLength,u=n.byteLength-1,d;for(let l=r;l<=a;l+=d){d=0;for(let f=u;f>=0;f--){let p=this.get(l+f);if(n[f]!==p){d=Math.max(1,f-c[p]);break}}if(d===0)return l}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=At(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=ht(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=At(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=ht(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=ht(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=ht(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ut(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var Po={};vt(Po,{base10:()=>mf});var mf=ye({prefix:"9",name:"base10",alphabet:"0123456789"});var To={};vt(To,{base16:()=>yf,base16upper:()=>bf});var yf=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bf=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Oo={};vt(Oo,{base2:()=>gf});var gf=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Lo={};vt(Lo,{base256emoji:()=>vf});var ji=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),xf=ji.reduce((e,t,r)=>(e[r]=t,e),[]),wf=ji.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function Ef(e){return e.reduce((t,r)=>(t+=xf[r],t),"")}function Sf(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=wf[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var vf=Ge({prefix:"\u{1F680}",name:"base256emoji",encode:Ef,decode:Sf});var No={};vt(No,{base64:()=>Af,base64pad:()=>If,base64url:()=>Ro,base64urlpad:()=>_f});var Af=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),If=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ro=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),_f=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Uo={};vt(Uo,{base8:()=>Cf});var Cf=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ko={};vt(Ko,{identity:()=>Bf});var Bf=Ge({prefix:"\0",name:"identity",encode:e=>Ni(e),decode:e=>Ri(e)});var wp=new TextEncoder,Ep=new TextDecoder;var Vo={};vt(Vo,{sha256:()=>Tr,sha512:()=>Of});var Tf=20;function Mo({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new ko(e,t,r,n,o)}var ko=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??Tf,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Xi(n,this.code,r?.truncate):n.then(o=>Xi(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Xi(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return $t(t,e)}function Ji(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var Tr=Mo({name:"sha2-256",code:18,encode:Ji("SHA-256")}),Of=Mo({name:"sha2-512",code:19,encode:Ji("SHA-512")});var Or={...Ko,...Oo,...Uo,...Po,...To,...Io,..._o,...Ao,...No,...Lo},Lp={...Vo,...Do};function ea(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var ta=ea("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Fo=ea("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=At(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Lf={utf8:ta,"utf-8":ta,hex:Or.base16,latin1:Fo,ascii:Fo,binary:Fo,...Or},vn=Lf;function k(e,t="utf8"){let r=vn[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function M(e,t="utf8"){let r=vn[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var Rf=parseInt("11111",2),qo=parseInt("10000000",2),Nf=parseInt("01111111",2),ra={0:Lr,1:Lr,2:Uf,3:Mf,4:Vf,5:kf,6:Kf,16:Lr,22:Lr,48:Lr};function te(e,t={offset:0}){let r=e[t.offset]&Rf;if(t.offset++,ra[r]!=null)return ra[r](e,t);throw new Error("No decoder for tag "+r)}function Rr(e,t){let r=0;if((e[t.offset]&qo)===qo){let n=e[t.offset]&Nf,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Lr(e,t){Rr(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=te(e,t);if(n===null)break;r.push(n)}return r}function Uf(e,t){let r=Rr(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function Kf(e,t){let r=Rr(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let u=e[t.offset];if(t.offset++,a.push(u&127),u<128){a.reverse();let d=0;for(let l=0;l<a.length;l++)d+=a[l]<<l*7;c+=`.${d}`,a=[]}}return c}function kf(e,t){return t.offset++,null}function Mf(e,t){let r=Rr(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function Vf(e,t){let r=Rr(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function Ff(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new ot;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function Ho(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=Ff(e.byteLength);return new ot(Uint8Array.from([t.byteLength|qo]),t)}function It(e){let t=new ot,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new ot(Uint8Array.from([2]),Ho(t),t)}function An(e){let t=Uint8Array.from([0]),r=new ot(t,e);return new ot(Uint8Array.from([3]),Ho(r),r)}function ge(e,t=48){let r=new ot;for(let n of e)r.append(n);return new ot(Uint8Array.from([t]),Ho(r),r)}async function na(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var qf=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Hf=Uint8Array.from([6,5,43,129,4,0,34]),zf=Uint8Array.from([6,5,43,129,4,0,35]),$f={ext:!0,kty:"EC",crv:"P-256"},Gf={ext:!0,kty:"EC",crv:"P-384"},Zf={ext:!0,kty:"EC",crv:"P-521"},zo=32,$o=48,Go=66;function Zo(e){let t=te(e);return oa(t)}function oa(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===zo*2+1)return n=M(t.subarray(r,r+zo),"base64url"),o=M(t.subarray(r+zo),"base64url"),new je({...$f,key_ops:["verify"],x:n,y:o});if(t.byteLength===$o*2+1)return n=M(t.subarray(r,r+$o),"base64url"),o=M(t.subarray(r+$o),"base64url"),new je({...Gf,key_ops:["verify"],x:n,y:o});if(t.byteLength===Go*2+1)return n=M(t.subarray(r,r+Go),"base64url"),o=M(t.subarray(r+Go),"base64url"),new je({...Zf,key_ops:["verify"],x:n,y:o});throw new ct(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function sa(e){return ge([It(Uint8Array.from([1])),ge([Yf(e.crv)],160),ge([An(new ot(Uint8Array.from([4]),k(e.x??"","base64url"),k(e.y??"","base64url")))],161)]).subarray()}function Yf(e){if(e==="P-256")return qf;if(e==="P-384")return Hf;if(e==="P-521")return zf;throw new ct(`Invalid curve ${e}`)}var je=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=sa(this.jwk)),this._raw}toMultihash(){return Kt.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}async verify(t,r,n){return na(this.jwk,r,t,n)}};var Te=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function re(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Nr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function _t(e,...t){if(!re(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function In(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Nr(e.outputLen),Nr(e.blockLen)}function Qe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function aa(e,t){_t(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ne(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _n(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function kt(e,t){return e<<32-t|e>>>t}var ca=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Wf=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Rt(e){if(_t(e),ca)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Wf[e[r]];return t}var ee={_0:48,_9:57,A:65,F:70,a:97,f:102};function ia(e){if(e>=ee._0&&e<=ee._9)return e-ee._0;if(e>=ee.A&&e<=ee.F)return e-(ee.A-10);if(e>=ee.a&&e<=ee.f)return e-(ee.a-10)}function Oe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ca)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=ia(e.charCodeAt(s)),c=ia(e.charCodeAt(s+1));if(i===void 0||c===void 0){let a=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function Yo(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Ur(e){return typeof e=="string"&&(e=Yo(e)),_t(e),e}function wt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];_t(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}var Xe=class{};function Wo(e){let t=n=>e().update(Ur(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Je(e=32){if(Te&&typeof Te.getRandomValues=="function")return Te.getRandomValues(new Uint8Array(e));if(Te&&typeof Te.randomBytes=="function")return Uint8Array.from(Te.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function jf(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),c=Number(r&s),a=n?4:0,u=n?0:4;e.setUint32(t+a,i,n),e.setUint32(t+u,c,n)}function ua(e,t,r){return e&t^~e&r}function fa(e,t,r){return e&t^e&r^t&r}var Kr=class extends Xe{constructor(t,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=_n(this.buffer)}update(t){Qe(this),t=Ur(t),_t(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=_n(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Qe(this),aa(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,ne(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)r[l]=0;jf(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=_n(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,d[l],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},oe=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var pt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var Cn=BigInt(4294967295),la=BigInt(32);function Xf(e,t=!1){return t?{h:Number(e&Cn),l:Number(e>>la&Cn)}:{h:Number(e>>la&Cn)|0,l:Number(e&Cn)|0}}function da(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=Xf(e[s],t);[n[s],o[s]]=[i,c]}return[n,o]}var jo=(e,t,r)=>e>>>r,Xo=(e,t,r)=>e<<32-r|t>>>r,Le=(e,t,r)=>e>>>r|t<<32-r,Re=(e,t,r)=>e<<32-r|t>>>r,kr=(e,t,r)=>e<<64-r|t>>>r-32,Mr=(e,t,r)=>e>>>r-32|t<<64-r;function Zt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ha=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),pa=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,ma=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),ya=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,ba=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ga=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var Jf=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xe=new Uint32Array(64),Bn=class extends Kr{constructor(t=32){super(64,t,8,!1),this.A=oe[0]|0,this.B=oe[1]|0,this.C=oe[2]|0,this.D=oe[3]|0,this.E=oe[4]|0,this.F=oe[5]|0,this.G=oe[6]|0,this.H=oe[7]|0}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,r,n,o,s,i,c,a]}set(t,r,n,o,s,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let l=0;l<16;l++,r+=4)xe[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let f=xe[l-15],p=xe[l-2],h=kt(f,7)^kt(f,18)^f>>>3,g=kt(p,17)^kt(p,19)^p>>>10;xe[l]=g+xe[l-7]+h+xe[l-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:u,H:d}=this;for(let l=0;l<64;l++){let f=kt(c,6)^kt(c,11)^kt(c,25),p=d+f+ua(c,a,u)+Jf[l]+xe[l]|0,g=(kt(n,2)^kt(n,13)^kt(n,22))+fa(n,o,s)|0;d=u,u=a,a=c,c=i+p|0,i=s,s=o,o=n,n=p+g|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,s,i,c,a,u,d)}roundClean(){ne(xe)}destroy(){this.set(0,0,0,0,0,0,0,0),ne(this.buffer)}};var xa=da(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),tl=xa[0],el=xa[1],we=new Uint32Array(80),Ee=new Uint32Array(80),Qo=class extends Kr{constructor(t=64){super(128,t,16,!1),this.Ah=pt[0]|0,this.Al=pt[1]|0,this.Bh=pt[2]|0,this.Bl=pt[3]|0,this.Ch=pt[4]|0,this.Cl=pt[5]|0,this.Dh=pt[6]|0,this.Dl=pt[7]|0,this.Eh=pt[8]|0,this.El=pt[9]|0,this.Fh=pt[10]|0,this.Fl=pt[11]|0,this.Gh=pt[12]|0,this.Gl=pt[13]|0,this.Hh=pt[14]|0,this.Hl=pt[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:u,El:d,Fh:l,Fl:f,Gh:p,Gl:h,Hh:g,Hl:v}=this;return[t,r,n,o,s,i,c,a,u,d,l,f,p,h,g,v]}set(t,r,n,o,s,i,c,a,u,d,l,f,p,h,g,v){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=d|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=h|0,this.Hh=g|0,this.Hl=v|0}process(t,r){for(let E=0;E<16;E++,r+=4)we[E]=t.getUint32(r),Ee[E]=t.getUint32(r+=4);for(let E=16;E<80;E++){let P=we[E-15]|0,R=Ee[E-15]|0,F=Le(P,R,1)^Le(P,R,8)^jo(P,R,7),V=Re(P,R,1)^Re(P,R,8)^Xo(P,R,7),N=we[E-2]|0,w=Ee[E-2]|0,B=Le(N,w,19)^kr(N,w,61)^jo(N,w,6),U=Re(N,w,19)^Mr(N,w,61)^Xo(N,w,6),D=ma(V,U,Ee[E-7],Ee[E-16]),b=ya(D,F,B,we[E-7],we[E-16]);we[E]=b|0,Ee[E]=D|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:u,Dl:d,Eh:l,El:f,Fh:p,Fl:h,Gh:g,Gl:v,Hh:x,Hl:A}=this;for(let E=0;E<80;E++){let P=Le(l,f,14)^Le(l,f,18)^kr(l,f,41),R=Re(l,f,14)^Re(l,f,18)^Mr(l,f,41),F=l&p^~l&g,V=f&h^~f&v,N=ba(A,R,V,el[E],Ee[E]),w=ga(N,x,P,F,tl[E],we[E]),B=N|0,U=Le(n,o,28)^kr(n,o,34)^kr(n,o,39),D=Re(n,o,28)^Mr(n,o,34)^Mr(n,o,39),b=n&s^n&c^s&c,m=o&i^o&a^i&a;x=g|0,A=v|0,g=p|0,v=h|0,p=l|0,h=f|0,{h:l,l:f}=Zt(u|0,d|0,w|0,B|0),u=c|0,d=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let y=ha(B,D,m);n=pa(y,w,U,b),o=y|0}({h:n,l:o}=Zt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Zt(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=Zt(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l:d}=Zt(this.Dh|0,this.Dl|0,u|0,d|0),{h:l,l:f}=Zt(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:h}=Zt(this.Fh|0,this.Fl|0,p|0,h|0),{h:g,l:v}=Zt(this.Gh|0,this.Gl|0,g|0,v|0),{h:x,l:A}=Zt(this.Hh|0,this.Hl|0,x|0,A|0),this.set(n,o,s,i,c,a,u,d,l,f,p,h,g,v,x,A)}roundClean(){ne(we,Ee)}destroy(){ne(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Dn=Wo(()=>new Bn);var wa=Wo(()=>new Qo);var es=BigInt(0),ts=BigInt(1);function se(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}"`;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Tt(e,t,r=""){let n=re(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,c=s?` of length ${t}`:"",a=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function Vr(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Ea(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?es:BigInt("0x"+e)}function tr(e){return Ea(Rt(e))}function ie(e){return _t(e),Ea(Rt(Uint8Array.from(e).reverse()))}function Pn(e,t){return Oe(e.toString(16).padStart(t*2,"0"))}function rs(e,t){return Pn(e,t).reverse()}function Z(e,t,r){let n;if(typeof t=="string")try{n=Oe(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(re(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}function Sa(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}function ns(e){return Uint8Array.from(e)}var Jo=e=>typeof e=="bigint"&&es<=e;function va(e,t,r){return Jo(e)&&Jo(t)&&Jo(r)&&t<=e&&e<r}function Fr(e,t,r,n){if(!va(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Tn(e){let t;for(t=0;e>es;e>>=ts,t+=1);return t}var Se=e=>(ts<<BigInt(e))-ts;function Aa(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),s=n(e),i=n(e),c=0,a=()=>{s.fill(1),i.fill(0),c=0},u=(...p)=>r(i,s,...p),d=(p=n(0))=>{i=u(o(0),p),s=u(),p.length!==0&&(i=u(o(1),p),s=u())},l=()=>{if(c++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,h=[];for(;p<t;){s=u();let g=s.slice();h.push(g),p+=s.length}return wt(...h)};return(p,h)=>{a(),d(p);let g;for(;!(g=h(l()));)d();return a(),g}}function ve(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(o,s,i){let c=e[o];if(i&&c===void 0)return;let a=typeof c;if(a!==s||c===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${a}`)}Object.entries(t).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}var os=()=>{throw new Error("not implemented")};function er(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var Et=BigInt(0),ft=BigInt(1),Ne=BigInt(2),Ca=BigInt(3),Ba=BigInt(4),Da=BigInt(5),rl=BigInt(7),Pa=BigInt(8),nl=BigInt(9),Ta=BigInt(16);function nt(e,t){let r=e%t;return r>=Et?r:t+r}function j(e,t,r){let n=e;for(;t-- >Et;)n*=n,n%=r;return n}function Ia(e,t){if(e===Et)throw new Error("invert: expected non-zero number");if(t<=Et)throw new Error("invert: expected positive modulus, got "+t);let r=nt(e,t),n=t,o=Et,s=ft,i=ft,c=Et;for(;r!==Et;){let u=n/r,d=n%r,l=o-i*u,f=s-c*u;n=r,r=d,o=i,s=c,i=l,c=f}if(n!==ft)throw new Error("invert: does not exist");return nt(o,t)}function ss(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Oa(e,t){let r=(e.ORDER+ft)/Ba,n=e.pow(t,r);return ss(e,n,t),n}function ol(e,t){let r=(e.ORDER-Da)/Pa,n=e.mul(t,Ne),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,Ne),o),c=e.mul(s,e.sub(i,e.ONE));return ss(e,c,t),c}function sl(e){let t=Ot(e),r=La(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+rl)/Ta;return(c,a)=>{let u=c.pow(a,i),d=c.mul(u,n),l=c.mul(u,o),f=c.mul(u,s),p=c.eql(c.sqr(d),a),h=c.eql(c.sqr(l),a);u=c.cmov(u,d,p),d=c.cmov(f,l,h);let g=c.eql(c.sqr(d),a),v=c.cmov(u,d,g);return ss(c,v,a),v}}function La(e){if(e<Ca)throw new Error("sqrt is not defined for small field");let t=e-ft,r=0;for(;t%Ne===Et;)t/=Ne,r++;let n=Ne,o=Ot(e);for(;_a(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Oa;let s=o.pow(n,t),i=(t+ft)/Ne;return function(a,u){if(a.is0(u))return u;if(_a(a,u)!==1)throw new Error("Cannot find square root");let d=r,l=a.mul(a.ONE,s),f=a.pow(u,t),p=a.pow(u,i);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let h=1,g=a.sqr(f);for(;!a.eql(g,a.ONE);)if(h++,g=a.sqr(g),h===d)throw new Error("Cannot find square root");let v=ft<<BigInt(d-h-1),x=a.pow(l,v);d=h,l=a.sqr(x),f=a.mul(f,l),p=a.mul(p,x)}return p}}function il(e){return e%Ba===Ca?Oa:e%Pa===Da?ol:e%Ta===nl?sl(e):La(e)}var ae=(e,t)=>(nt(e,t)&ft)===ft,al=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function is(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=al.reduce((n,o)=>(n[o]="function",n),t);return ve(e,r),e}function cl(e,t,r){if(r<Et)throw new Error("invalid exponent, negatives unsupported");if(r===Et)return e.ONE;if(r===ft)return t;let n=e.ONE,o=t;for(;r>Et;)r&ft&&(n=e.mul(n,o)),o=e.sqr(o),r>>=ft;return n}function qr(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),s),n}function _a(e,t){let r=(e.ORDER-ft)/Ne,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function On(e,t){t!==void 0&&Nr(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ot(e,t,r=!1,n={}){if(e<=Et)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s,i=!1,c;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),c=f.allowedLengths}else typeof t=="number"&&(o=t),n.sqrt&&(s=n.sqrt);let{nBitLength:a,nByteLength:u}=On(e,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let d,l=Object.freeze({ORDER:e,isLE:r,BITS:a,BYTES:u,MASK:Se(a),ZERO:Et,ONE:ft,allowedLengths:c,create:f=>nt(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Et<=f&&f<e},is0:f=>f===Et,isValidNot0:f=>!l.is0(f)&&l.isValid(f),isOdd:f=>(f&ft)===ft,neg:f=>nt(-f,e),eql:(f,p)=>f===p,sqr:f=>nt(f*f,e),add:(f,p)=>nt(f+p,e),sub:(f,p)=>nt(f-p,e),mul:(f,p)=>nt(f*p,e),pow:(f,p)=>cl(l,f,p),div:(f,p)=>nt(f*Ia(p,e),e),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>Ia(f,e),sqrt:s||(f=>(d||(d=il(e)),d(l,f))),toBytes:f=>r?rs(f,u):Pn(f,u),fromBytes:(f,p=!0)=>{if(c){if(!c.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);let g=new Uint8Array(u);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let h=r?ie(f):tr(f);if(i&&(h=nt(h,e)),!p&&!l.isValid(h))throw new Error("invalid field element: outside of range 0..ORDER");return h},invertBatch:f=>qr(l,f),cmov:(f,p,h)=>h?p:f});return Object.freeze(l)}function Ra(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function as(e){let t=Ra(e);return t+Math.ceil(t/2)}function cs(e,t,r=!1){let n=e.length,o=Ra(t),s=as(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?ie(e):tr(e),c=nt(i,t-ft)+ft;return r?rs(c,o):Pn(c,o)}var rr=BigInt(0),Ue=BigInt(1);function Hr(e,t){let r=t.negate();return e?r:t}function ce(e,t){let r=qr(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function ka(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function us(e,t){ka(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Se(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Na(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(e&o),a=e>>i;c>n&&(c-=s,a+=Ue);let u=t*n,d=u+Math.abs(c)-1,l=c===0,f=c<0,p=t%2!==0;return{nextN:a,offset:d,isZero:l,isNeg:f,isNegF:p,offsetF:u}}function ul(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function fl(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var fs=new WeakMap,Ma=new WeakMap;function ls(e){return Ma.get(e)||1}function Ua(e){if(e!==rr)throw new Error("invalid wNAF")}var nr=class{constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>rr;)r&Ue&&(n=n.add(o)),o=o.double(),r>>=Ue;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=us(r,this.bits),s=[],i=t,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=us(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:d,isNeg:l,isNegF:f,offsetF:p}=Na(n,c,i);n=a,d?s=s.add(Hr(f,r[p])):o=o.add(Hr(l,r[u]))}return Ua(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=us(t,this.bits);for(let i=0;i<s.windows&&n!==rr;i++){let{nextN:c,offset:a,isZero:u,isNeg:d}=Na(n,i,s);if(n=c,!u){let l=r[a];o=o.add(d?l.negate():l)}}return Ua(n),o}getPrecomputes(t,r,n){let o=fs.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),fs.set(r,o))),o}cached(t,r,n){let o=ls(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=ls(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){ka(r,this.bits),Ma.set(t,r),fs.delete(t)}hasCache(t){return ls(t)!==1}};function Va(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>rr||n>rr;)r&Ue&&(s=s.add(o)),n&Ue&&(i=i.add(o)),o=o.double(),r>>=Ue,n>>=Ue;return{p1:s,p2:i}}function or(e,t,r,n){ul(r,e),fl(n,t);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,c=Tn(BigInt(o)),a=1;c>12?a=c-3:c>4?a=c-2:c>0&&(a=2);let u=Se(a),d=new Array(Number(u)+1).fill(i),l=Math.floor((t.BITS-1)/a)*a,f=i;for(let p=l;p>=0;p-=a){d.fill(i);for(let g=0;g<s;g++){let v=n[g],x=Number(v>>BigInt(p)&u);d[x]=d[x].add(r[g])}let h=i;for(let g=d.length-1,v=i;g>0;g--)v=v.add(d[g]),h=h.add(v);if(f=f.add(h),p!==0)for(let g=0;g<a;g++)f=f.double()}return f}function Ka(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return is(t),t}else return Ot(e,{isLE:r})}function Ln(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let u=t[a];if(!(typeof u=="bigint"&&u>rr))throw new Error(`CURVE.${a} must be positive bigint`)}let o=Ka(t.p,r.Fp,n),s=Ka(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}var Ae=BigInt(0),lt=BigInt(1),ds=BigInt(2),ll=BigInt(8);function dl(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function hl(e,t={}){let r=Ln("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;ve(t,{},{uvRatio:"function"});let c=ds<<BigInt(o.BYTES*8)-lt,a=v=>n.create(v),u=t.uvRatio||((v,x)=>{try{return{isValid:!0,value:n.sqrt(n.div(v,x))}}catch{return{isValid:!1,value:Ae}}});if(!dl(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function d(v,x,A=!1){let E=A?lt:Ae;return Fr("coordinate "+v,x,E,c),x}function l(v){if(!(v instanceof h))throw new Error("ExtendedPoint expected")}let f=er((v,x)=>{let{X:A,Y:E,Z:P}=v,R=v.is0();x==null&&(x=R?ll:n.inv(P));let F=a(A*x),V=a(E*x),N=n.mul(P,x);if(R)return{x:Ae,y:lt};if(N!==lt)throw new Error("invZ was invalid");return{x:F,y:V}}),p=er(v=>{let{a:x,d:A}=s;if(v.is0())throw new Error("bad point: ZERO");let{X:E,Y:P,Z:R,T:F}=v,V=a(E*E),N=a(P*P),w=a(R*R),B=a(w*w),U=a(V*x),D=a(w*a(U+N)),b=a(B+a(A*a(V*N)));if(D!==b)throw new Error("bad point: equation left != right (1)");let m=a(E*P),y=a(R*F);if(m!==y)throw new Error("bad point: equation left != right (2)");return!0});class h{constructor(x,A,E,P){this.X=d("x",x),this.Y=d("y",A),this.Z=d("z",E,!0),this.T=d("t",P),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){if(x instanceof h)throw new Error("extended point not allowed");let{x:A,y:E}=x||{};return d("x",A),d("y",E),new h(A,E,lt,a(A*E))}static fromBytes(x,A=!1){let E=n.BYTES,{a:P,d:R}=s;x=ns(Tt(x,E,"point")),se(A,"zip215");let F=ns(x),V=x[E-1];F[E-1]=V&-129;let N=ie(F),w=A?c:n.ORDER;Fr("point.y",N,Ae,w);let B=a(N*N),U=a(B-lt),D=a(R*B-P),{isValid:b,value:m}=u(U,D);if(!b)throw new Error("bad point: invalid y coordinate");let y=(m&lt)===lt,S=(V&128)!==0;if(!A&&m===Ae&&S)throw new Error("bad point: x=0 and x_0=1");return S!==y&&(m=a(-m)),h.fromAffine({x:m,y:N})}static fromHex(x,A=!1){return h.fromBytes(Z("point",x),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,A=!0){return g.createCache(this,x),A||this.multiply(ds),this}assertValidity(){p(this)}equals(x){l(x);let{X:A,Y:E,Z:P}=this,{X:R,Y:F,Z:V}=x,N=a(A*V),w=a(R*P),B=a(E*V),U=a(F*P);return N===w&&B===U}is0(){return this.equals(h.ZERO)}negate(){return new h(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:x}=s,{X:A,Y:E,Z:P}=this,R=a(A*A),F=a(E*E),V=a(ds*a(P*P)),N=a(x*R),w=A+E,B=a(a(w*w)-R-F),U=N+F,D=U-V,b=N-F,m=a(B*D),y=a(U*b),S=a(B*b),I=a(D*U);return new h(m,y,I,S)}add(x){l(x);let{a:A,d:E}=s,{X:P,Y:R,Z:F,T:V}=this,{X:N,Y:w,Z:B,T:U}=x,D=a(P*N),b=a(R*w),m=a(V*E*U),y=a(F*B),S=a((P+R)*(N+w)-D-b),I=y-m,T=y+m,_=a(b-A*D),C=a(S*I),L=a(T*_),K=a(S*_),J=a(I*T);return new h(C,L,J,K)}subtract(x){return this.add(x.negate())}multiply(x){if(!o.isValidNot0(x))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:A,f:E}=g.cached(this,x,P=>ce(h,P));return ce(h,[A,E])[0]}multiplyUnsafe(x,A=h.ZERO){if(!o.isValid(x))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return x===Ae?h.ZERO:this.is0()||x===lt?this:g.unsafe(this,x,E=>ce(h,E),A)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return g.unsafe(this,s.n).is0()}toAffine(x){return f(this,x)}clearCofactor(){return i===lt?this:this.multiplyUnsafe(i)}toBytes(){let{x,y:A}=this.toAffine(),E=n.toBytes(A);return E[E.length-1]|=x&lt?128:0,E}toHex(){return Rt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(x){return ce(h,x)}static msm(x,A){return or(h,o,x,A)}_setWindowSize(x){this.precompute(x)}toRawBytes(){return this.toBytes()}}h.BASE=new h(s.Gx,s.Gy,lt,a(s.Gx*s.Gy)),h.ZERO=new h(Ae,lt,lt,Ae),h.Fp=n,h.Fn=o;let g=new nr(h,o.BITS);return h.BASE.precompute(8),h}var Rn=class{constructor(t){this.ep=t}static fromBytes(t){os()}static fromHex(t){os()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toHex(){return Rt(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,r){return this.init(this.ep.precompute(t,r))}toRawBytes(){return this.toBytes()}};function pl(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');ve(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,c=r.randomBytes||Je,a=r.adjustScalarBytes||(w=>w),u=r.domain||((w,B,U)=>{if(se(U,"phflag"),B.length||U)throw new Error("Contexts/pre-hash are not supported");return w});function d(w){return i.create(ie(w))}function l(w){let B=E.secretKey;w=Z("private key",w,B);let U=Z("hashed private key",t(w),2*B),D=a(U.slice(0,B)),b=U.slice(B,2*B),m=d(D);return{head:D,prefix:b,scalar:m}}function f(w){let{head:B,prefix:U,scalar:D}=l(w),b=o.multiply(D),m=b.toBytes();return{head:B,prefix:U,scalar:D,point:b,pointBytes:m}}function p(w){return f(w).pointBytes}function h(w=Uint8Array.of(),...B){let U=wt(...B);return d(t(u(U,Z("context",w),!!n)))}function g(w,B,U={}){w=Z("message",w),n&&(w=n(w));let{prefix:D,scalar:b,pointBytes:m}=f(B),y=h(U.context,D,w),S=o.multiply(y).toBytes(),I=h(U.context,S,m,w),T=i.create(y+I*b);if(!i.isValid(T))throw new Error("sign failed: invalid s");let _=wt(S,i.toBytes(T));return Tt(_,E.signature,"result")}let v={zip215:!0};function x(w,B,U,D=v){let{context:b,zip215:m}=D,y=E.signature;w=Z("signature",w,y),B=Z("message",B),U=Z("publicKey",U,E.publicKey),m!==void 0&&se(m,"zip215"),n&&(B=n(B));let S=y/2,I=w.subarray(0,S),T=ie(w.subarray(S,y)),_,C,L;try{_=e.fromBytes(U,m),C=e.fromBytes(I,m),L=o.multiplyUnsafe(T)}catch{return!1}if(!m&&_.isSmallOrder())return!1;let K=h(b,C.toBytes(),_.toBytes(),B);return C.add(_.multiplyUnsafe(K)).subtract(L).clearCofactor().is0()}let A=s.BYTES,E={secretKey:A,publicKey:A,signature:2*A,seed:A};function P(w=c(E.seed)){return Tt(w,E.seed,"seed")}function R(w){let B=N.randomSecretKey(w);return{secretKey:B,publicKey:p(B)}}function F(w){return re(w)&&w.length===i.BYTES}function V(w,B){try{return!!e.fromBytes(w,B)}catch{return!1}}let N={getExtendedPublicKey:f,randomSecretKey:P,isValidSecretKey:F,isValidPublicKey:V,toMontgomery(w){let{y:B}=e.fromBytes(w),U=E.publicKey,D=U===32;if(!D&&U!==57)throw new Error("only defined for 25519 and 448");let b=D?s.div(lt+B,lt-B):s.div(B-lt,B+lt);return s.toBytes(b)},toMontgomerySecret(w){let B=E.secretKey;Tt(w,B);let U=t(w.subarray(0,B));return a(U).subarray(0,B)},randomPrivateKey:P,precompute(w=8,B=e.BASE){return B.precompute(w,!1)}};return Object.freeze({keygen:R,getPublicKey:p,sign:g,verify:x,utils:N,Point:e,lengths:E})}function ml(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Ot(t.n,e.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:e.uvRatio},s={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,hash:e.hash,eddsaOpts:s}}function yl(e,t){let r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function Fa(e){let{CURVE:t,curveOpts:r,hash:n,eddsaOpts:o}=ml(e),s=hl(t,r),i=pl(s,n,o);return yl(e,i)}var bl=BigInt(0),ue=BigInt(1),qa=BigInt(2),F0=BigInt(3),gl=BigInt(5),xl=BigInt(8),sr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),zr={p:sr,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:xl,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function wl(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=sr,c=e*e%s*e%s,a=j(c,qa,s)*c%s,u=j(a,ue,s)*e%s,d=j(u,gl,s)*u%s,l=j(d,t,s)*d%s,f=j(l,r,s)*l%s,p=j(f,n,s)*f%s,h=j(p,o,s)*p%s,g=j(h,o,s)*p%s,v=j(g,t,s)*d%s;return{pow_p_5_8:j(v,qa,s)*e%s,b2:c}}function El(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var hs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function ys(e,t){let r=sr,n=nt(t*t*t,r),o=nt(n*n*t,r),s=wl(e*o).pow_p_5_8,i=nt(e*n*s,r),c=nt(t*i*i,r),a=i,u=nt(i*hs,r),d=c===e,l=c===nt(-e,r),f=c===nt(-e*hs,r);return d&&(i=a),(l||f)&&(i=u),ae(i,r)&&(i=nt(-i,r)),{isValid:d||l,value:i}}var Ie=Ot(zr.p,{isLE:!0}),Sl=Ot(zr.n,{isLE:!0}),vl={...zr,Fp:Ie,hash:wa,adjustScalarBytes:El,uvRatio:ys},fe=Fa(vl);var ps=hs,Al=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Il=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),_l=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Cl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Ha=e=>ys(ue,e),Bl=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),ms=e=>fe.Point.Fp.create(ie(e)&Bl);function za(e){let{d:t}=zr,r=sr,n=x=>Ie.create(x),o=n(ps*e*e),s=n((o+ue)*_l),i=BigInt(-1),c=n((i-t*o)*n(o+t)),{isValid:a,value:u}=ys(s,c),d=n(u*e);ae(d,r)||(d=n(-d)),a||(u=d),a||(i=o);let l=n(i*(o-ue)*Cl-c),f=u*u,p=n((u+u)*c),h=n(l*Al),g=n(ue-f),v=n(ue+f);return new fe.Point(n(p*v),n(g*h),n(h*v),n(p*g))}function Dl(e){_t(e,64);let t=ms(e.subarray(0,32)),r=za(t),n=ms(e.subarray(32,64)),o=za(n);return new le(r.add(o))}var le=class e extends Rn{constructor(t){super(t)}static fromAffine(t){return new e(fe.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return Dl(Z("ristrettoHash",t,64))}static fromBytes(t){_t(t,32);let{a:r,d:n}=zr,o=sr,s=P=>Ie.create(P),i=ms(t);if(!Sa(Ie.toBytes(i),t)||ae(i,o))throw new Error("invalid ristretto255 encoding 1");let c=s(i*i),a=s(ue+r*c),u=s(ue-r*c),d=s(a*a),l=s(u*u),f=s(r*n*d-l),{isValid:p,value:h}=Ha(s(f*l)),g=s(h*u),v=s(h*g*f),x=s((i+i)*g);ae(x,o)&&(x=s(-x));let A=s(a*v),E=s(x*A);if(!p||ae(E,o)||A===bl)throw new Error("invalid ristretto255 encoding 2");return new e(new fe.Point(x,A,ue,E))}static fromHex(t){return e.fromBytes(Z("ristrettoHex",t,32))}static msm(t,r){return or(e,fe.Point.Fn,t,r)}toBytes(){let{X:t,Y:r,Z:n,T:o}=this.ep,s=sr,i=v=>Ie.create(v),c=i(i(n+r)*i(n-r)),a=i(t*r),u=i(a*a),{value:d}=Ha(i(c*u)),l=i(d*c),f=i(d*a),p=i(l*f*o),h;if(ae(o*p,s)){let v=i(r*ps),x=i(t*ps);t=v,r=x,h=i(l*Il)}else h=f;ae(t*p,s)&&(r=i(-r));let g=i((n-r)*h);return ae(g,s)&&(g=i(-g)),Ie.toBytes(g)}equals(t){this.assertSame(t);let{X:r,Y:n}=this.ep,{X:o,Y:s}=t.ep,i=u=>Ie.create(u),c=i(r*s)===i(n*o),a=i(n*s)===i(r*o);return c||a}is0(){return this.equals(e.ZERO)}};le.BASE=new le(fe.Point.BASE);le.ZERO=new le(fe.Point.ZERO);le.Fp=Ie;le.Fn=Sl;var $r=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},Nn=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var $a={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new Nn("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var Nt=$a;var Un=32;var bs,Pl=(async()=>{try{return await Nt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Tl(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await Nt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await Nt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function Ol(e,t,r){return fe.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function Ga(e,t,r){return bs==null&&(bs=await Pl),bs?Tl(e,t,r):Ol(e,t,r)}function Kn(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var kn=class{type="Ed25519";raw;constructor(t){this.raw=gs(t,Un)}toMultihash(){return Kt.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=Ga(this.raw,r,t);return Kn(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function xs(e){return e=gs(e,Un),new kn(e)}function gs(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new ct(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Rl=Math.pow(2,7),Nl=Math.pow(2,14),Ul=Math.pow(2,21),ws=Math.pow(2,28),Es=Math.pow(2,35),Ss=Math.pow(2,42),vs=Math.pow(2,49),$=128,bt=127;function Ct(e){if(e<Rl)return 1;if(e<Nl)return 2;if(e<Ul)return 3;if(e<ws)return 4;if(e<Es)return 5;if(e<Ss)return 6;if(e<vs)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ir(e,t,r=0){switch(Ct(e)){case 8:t[r++]=e&255|$,e/=128;case 7:t[r++]=e&255|$,e/=128;case 6:t[r++]=e&255|$,e/=128;case 5:t[r++]=e&255|$,e/=128;case 4:t[r++]=e&255|$,e>>>=7;case 3:t[r++]=e&255|$,e>>>=7;case 2:t[r++]=e&255|$,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function Kl(e,t,r=0){switch(Ct(e)){case 8:t.set(r++,e&255|$),e/=128;case 7:t.set(r++,e&255|$),e/=128;case 6:t.set(r++,e&255|$),e/=128;case 5:t.set(r++,e&255|$),e/=128;case 4:t.set(r++,e&255|$),e>>>=7;case 3:t.set(r++,e&255|$),e>>>=7;case 2:t.set(r++,e&255|$),e>>>=7;case 1:{t.set(r++,e&255),e>>>=7;break}default:throw new Error("unreachable")}return t}function As(e,t){let r=e[t],n=0;if(n+=r&bt,r<$||(r=e[t+1],n+=(r&bt)<<7,r<$)||(r=e[t+2],n+=(r&bt)<<14,r<$)||(r=e[t+3],n+=(r&bt)<<21,r<$)||(r=e[t+4],n+=(r&bt)*ws,r<$)||(r=e[t+5],n+=(r&bt)*Es,r<$)||(r=e[t+6],n+=(r&bt)*Ss,r<$)||(r=e[t+7],n+=(r&bt)*vs,r<$))return n;throw new RangeError("Could not decode varint")}function kl(e,t){let r=e.get(t),n=0;if(n+=r&bt,r<$||(r=e.get(t+1),n+=(r&bt)<<7,r<$)||(r=e.get(t+2),n+=(r&bt)<<14,r<$)||(r=e.get(t+3),n+=(r&bt)<<21,r<$)||(r=e.get(t+4),n+=(r&bt)*ws,r<$)||(r=e.get(t+5),n+=(r&bt)*Es,r<$)||(r=e.get(t+6),n+=(r&bt)*Ss,r<$)||(r=e.get(t+7),n+=(r&bt)*vs,r<$))return n;throw new RangeError("Could not decode varint")}function ar(e,t,r=0){return t==null&&(t=At(Ct(e))),t instanceof Uint8Array?ir(e,t,r):Kl(e,t,r)}function Gr(e,t=0){return e instanceof Uint8Array?As(e,t):kl(e,t)}var _s=new Float32Array([-0]),_e=new Uint8Array(_s.buffer);function Ya(e,t,r){_s[0]=e,t[r]=_e[0],t[r+1]=_e[1],t[r+2]=_e[2],t[r+3]=_e[3]}function Wa(e,t){return _e[0]=e[t],_e[1]=e[t+1],_e[2]=e[t+2],_e[3]=e[t+3],_s[0]}var Cs=new Float64Array([-0]),gt=new Uint8Array(Cs.buffer);function ja(e,t,r){Cs[0]=e,t[r]=gt[0],t[r+1]=gt[1],t[r+2]=gt[2],t[r+3]=gt[3],t[r+4]=gt[4],t[r+5]=gt[5],t[r+6]=gt[6],t[r+7]=gt[7]}function Xa(e,t){return gt[0]=e[t],gt[1]=e[t+1],gt[2]=e[t+2],gt[3]=e[t+3],gt[4]=e[t+4],gt[5]=e[t+5],gt[6]=e[t+6],gt[7]=e[t+7],Cs[0]}var Ml=BigInt(Number.MAX_SAFE_INTEGER),Vl=BigInt(Number.MIN_SAFE_INTEGER),Lt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Ke;if(t<Ml&&t>Vl)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>Qa&&(o=0n,++n>Qa&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return Ke;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):Ke}},Ke=new Lt(0,0);Ke.toBigInt=function(){return 0n};Ke.zzEncode=Ke.zzDecode=function(){return this};Ke.length=function(){return 1};var Qa=4294967296n;function Ja(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function tc(e,t,r){if(r-t<1)return"";let o,s=[],i=0,c;for(;t<r;)c=e[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Bs(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Mt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function Mn(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Ds=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Mt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Mt(this,4);return Mn(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Mt(this,4);return Mn(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Mt(this,4);let t=Wa(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Mt(this,4);let t=Xa(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Mt(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return tc(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Mt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Mt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Lt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Mt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Mt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Mt(this,8);let t=Mn(this.buf,this.pos+=4),r=Mn(this.buf,this.pos+=4);return new Lt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=As(this.buf,this.pos);return this.pos+=Ct(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Ps(e){return new Ds(e instanceof Uint8Array?e:e.subarray())}function Vt(e,t,r){let n=Ps(e);return t.decode(n,void 0,r)}function Ts(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return At(i);o+i>t&&(n=At(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var ke=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function Os(){}var Rs=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},Fl=Ts();function ql(e){return globalThis.Buffer!=null?At(e):Fl(e)}var Yr=class{len;head;tail;states;constructor(){this.len=0,this.head=new ke(Os,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new ke(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Ns((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Vn,10,Lt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=Lt.fromBigInt(t);return this._push(Vn,r.length(),r)}uint64Number(t){return this._push(ir,Ct(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=Lt.fromBigInt(t).zzEncode();return this._push(Vn,r.length(),r)}sint64Number(t){let r=Lt.fromNumber(t).zzEncode();return this._push(Vn,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(Ls,1,t?1:0)}fixed32(t){return this._push(Zr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=Lt.fromBigInt(t);return this._push(Zr,4,r.lo)._push(Zr,4,r.hi)}fixed64Number(t){let r=Lt.fromNumber(t);return this._push(Zr,4,r.lo)._push(Zr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Ya,4,t)}double(t){return this._push(ja,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(Ls,1,0):this.uint32(r)._push(zl,r,t)}string(t){let r=Ja(t);return r!==0?this.uint32(r)._push(Bs,r,t):this._push(Ls,1,0)}fork(){return this.states=new Rs(this),this.head=this.tail=new ke(Os,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ke(Os,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=ql(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function Ls(e,t,r){t[r]=e&255}function Hl(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var Ns=class extends ke{next;constructor(t,r){super(Hl,t,r),this.next=void 0}};function Vn(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Zr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function zl(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Yr.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push($l,t,e),this},Yr.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(Gl,t,e),this});function $l(e,t,r){t.set(e,r)}function Gl(e,t,r){e.length<40?Bs(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(k(e),r)}function Us(){return new Yr}function Ft(e,t){let r=Us();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var cr;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(cr||(cr={}));function Fn(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function Ks(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return Fn("enum",cr.VARINT,r,n)}function qt(e,t){return Fn("message",cr.LENGTH_DELIMITED,e,t)}var Me=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var st;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(st||(st={}));var ks;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(ks||(ks={}));(function(e){e.codec=()=>Ks(ks)})(st||(st={}));var Yt;(function(e){let t;e.codec=()=>(t==null&&(t=qt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),st.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Ft(r,e.codec()),e.decode=(r,n)=>Vt(r,e.codec(),n)})(Yt||(Yt={}));var Ms;(function(e){let t;e.codec=()=>(t==null&&(t=qt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),st.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Ft(r,e.codec()),e.decode=(r,n)=>Vt(r,e.codec(),n)})(Ms||(Ms={}));var jr={};vt(jr,{MAX_RSA_KEY_SIZE:()=>Vs,generateRSAKeyPair:()=>ic,jwkToJWKKeyPair:()=>ac,jwkToPkcs1:()=>jl,jwkToPkix:()=>zs,jwkToRSAPrivateKey:()=>Ys,pkcs1MessageToJwk:()=>qs,pkcs1MessageToRSAPrivateKey:()=>$s,pkcs1ToJwk:()=>Wl,pkcs1ToRSAPrivateKey:()=>sc,pkixMessageToJwk:()=>Hs,pkixMessageToRSAPublicKey:()=>Zs,pkixToJwk:()=>Xl,pkixToRSAPublicKey:()=>Gs});var qn=Dn;var ur=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=jr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return it.createV1(114,this._multihash)}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){return oc(this.jwk,r,t,n)}},Wr=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=jr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}sign(t,r){return nc(this.jwk,t,r)}};var Vs=8192,Fs=18,Zl=1062,Yl=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Wl(e){let t=te(e);return qs(t)}function qs(e){return{n:M(e[1],"base64url"),e:M(e[2],"base64url"),d:M(e[3],"base64url"),p:M(e[4],"base64url"),q:M(e[5],"base64url"),dp:M(e[6],"base64url"),dq:M(e[7],"base64url"),qi:M(e[8],"base64url"),kty:"RSA"}}function jl(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new ct("JWK was missing components");return ge([It(Uint8Array.from([0])),It(k(e.n,"base64url")),It(k(e.e,"base64url")),It(k(e.d,"base64url")),It(k(e.p,"base64url")),It(k(e.q,"base64url")),It(k(e.dp,"base64url")),It(k(e.dq,"base64url")),It(k(e.qi,"base64url"))]).subarray()}function Xl(e){let t=te(e,{offset:0});return Hs(t)}function Hs(e){let t=te(e[1],{offset:0});return{kty:"RSA",n:M(t[0],"base64url"),e:M(t[1],"base64url")}}function zs(e){if(e.n==null||e.e==null)throw new ct("JWK was missing components");return ge([Yl,An(ge([It(k(e.n,"base64url")),It(k(e.e,"base64url"))]))]).subarray()}function sc(e){let t=te(e);return $s(t)}function $s(e){let t=qs(e);return Ys(t)}function Gs(e,t){if(e.byteLength>=Zl)throw new $e("Key size is too large");let r=te(e,{offset:0});return Zs(r,e,t)}function Zs(e,t,r){let n=Hs(e);if(r==null){let o=qn(Yt.encode({Type:st.RSA,Data:t}));r=$t(Fs,o)}return new ur(n,r)}function Ys(e){if(uc(e)>Vs)throw new ct("Key size is too large");let t=ac(e),r=qn(Yt.encode({Type:st.RSA,Data:zs(t.publicKey)})),n=$t(Fs,r);return new Wr(t.privateKey,new ur(t.publicKey,n))}async function ic(e){if(e>Vs)throw new ct("Key size is too large");let t=await cc(e),r=qn(Yt.encode({Type:st.RSA,Data:zs(t.publicKey)})),n=$t(Fs,r);return new Wr(t.privateKey,new ur(t.publicKey,n))}function ac(e){if(e==null)throw new ct("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function cc(e,t){let r=await Nt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await Ql(r,t);return{privateKey:n[0],publicKey:n[1]}}async function nc(e,t,r){let n=await Nt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await Nt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function oc(e,t,r,n){let o=await Nt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await Nt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function Ql(e,t){if(e.privateKey==null||e.publicKey==null)throw new ct("Private and public key are required");let r=await Promise.all([Nt.get().subtle.exportKey("jwk",e.privateKey),Nt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function uc(e){if(e.kty!=="RSA")throw new ct("invalid key type");if(e.n==null)throw new ct("invalid key modulus");return k(e.n,"base64url").length*8}var Hn=class extends Xe{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,In(t);let n=Ur(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),ne(s)}update(t){return Qe(this),this.iHash.update(t),this}digestInto(t){Qe(this),_t(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ws=(e,t,r)=>new Hn(e,t).update(r).digest();Ws.create=(e,t)=>new Hn(e,t);var fc=(e,t)=>(e+(e>=0?t:-t)/lc)/t;function Jl(e,t,r){let[[n,o],[s,i]]=t,c=fc(i*e,r),a=fc(-o*e,r),u=e-c*n-a*s,d=-c*o-a*i,l=u<he,f=d<he;l&&(u=-u),f&&(d=-d);let p=Se(Math.ceil(Tn(r)/2))+lr;if(u<he||u>=p||d<he||d>=p)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:l,k1:u,k2neg:f,k2:d}}function Xs(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function js(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return se(r.lowS,"lowS"),se(r.prehash,"prehash"),r.format!==void 0&&Xs(r.format),r}var Qs=class extends Error{constructor(t=""){super(t)}},de={Err:Qs,_tlv:{encode:(e,t)=>{let{Err:r}=de;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Vr(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Vr(o.length/2|128):"";return Vr(e)+s+o+t},decode(e,t){let{Err:r}=de,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+a);if(u.length!==a)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let d of u)i=i<<8|d;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=de;if(e<he)throw new t("integer: negative integers are not allowed");let r=Vr(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=de;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return tr(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=de,o=Z("signature",e),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:u,l:d}=n.decode(2,a);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=de,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},he=BigInt(0),lr=BigInt(1),lc=BigInt(2),zn=BigInt(3),td=BigInt(4);function fr(e,t){let{BYTES:r}=e,n;if(typeof t=="bigint")n=t;else{let o=Z("private key",t);try{n=e.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function ed(e,t={}){let r=Ln("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;ve(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:a}=t;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=hc(n,o);function d(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(D,b,m){let{x:y,y:S}=b.toAffine(),I=n.toBytes(y);if(se(m,"isCompressed"),m){d();let T=!n.isOdd(S);return wt(dc(T),I)}else return wt(Uint8Array.of(4),I,n.toBytes(S))}function f(D){Tt(D,void 0,"Point");let{publicKey:b,publicKeyUncompressed:m}=u,y=D.length,S=D[0],I=D.subarray(1);if(y===b&&(S===2||S===3)){let T=n.fromBytes(I);if(!n.isValid(T))throw new Error("bad point: is not on curve, wrong x");let _=g(T),C;try{C=n.sqrt(_)}catch(J){let Y=J instanceof Error?": "+J.message:"";throw new Error("bad point: is not on curve, sqrt error"+Y)}d();let L=n.isOdd(C);return(S&1)===1!==L&&(C=n.neg(C)),{x:T,y:C}}else if(y===m&&S===4){let T=n.BYTES,_=n.fromBytes(I.subarray(0,T)),C=n.fromBytes(I.subarray(T,T*2));if(!v(_,C))throw new Error("bad point: is not on curve");return{x:_,y:C}}else throw new Error(`bad point: got length ${y}, expected compressed=${b} or uncompressed=${m}`)}let p=t.toBytes||l,h=t.fromBytes||f;function g(D){let b=n.sqr(D),m=n.mul(b,D);return n.add(n.add(m,n.mul(D,s.a)),s.b)}function v(D,b){let m=n.sqr(b),y=g(D);return n.eql(m,y)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let x=n.mul(n.pow(s.a,zn),td),A=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(x,A)))throw new Error("bad curve params: a or b");function E(D,b,m=!1){if(!n.isValid(b)||m&&n.is0(b))throw new Error(`bad point coordinate ${D}`);return b}function P(D){if(!(D instanceof w))throw new Error("ProjectivePoint expected")}function R(D){if(!a||!a.basises)throw new Error("no endo");return Jl(D,a.basises,o.ORDER)}let F=er((D,b)=>{let{X:m,Y:y,Z:S}=D;if(n.eql(S,n.ONE))return{x:m,y};let I=D.is0();b==null&&(b=I?n.ONE:n.inv(S));let T=n.mul(m,b),_=n.mul(y,b),C=n.mul(S,b);if(I)return{x:n.ZERO,y:n.ZERO};if(!n.eql(C,n.ONE))throw new Error("invZ was invalid");return{x:T,y:_}}),V=er(D=>{if(D.is0()){if(t.allowInfinityPoint&&!n.is0(D.Y))return;throw new Error("bad point: ZERO")}let{x:b,y:m}=D.toAffine();if(!n.isValid(b)||!n.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(b,m))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function N(D,b,m,y,S){return m=new w(n.mul(m.X,D),m.Y,m.Z),b=Hr(y,b),m=Hr(S,m),b.add(m)}class w{constructor(b,m,y){this.X=E("x",b),this.Y=E("y",m,!0),this.Z=E("z",y),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){let{x:m,y}=b||{};if(!b||!n.isValid(m)||!n.isValid(y))throw new Error("invalid affine point");if(b instanceof w)throw new Error("projective point not allowed");return n.is0(m)&&n.is0(y)?w.ZERO:new w(m,y,n.ONE)}static fromBytes(b){let m=w.fromAffine(h(Tt(b,void 0,"point")));return m.assertValidity(),m}static fromHex(b){return w.fromBytes(Z("pointHex",b))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,m=!0){return U.createCache(this,b),m||this.multiply(zn),this}assertValidity(){V(this)}hasEvenY(){let{y:b}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(b)}equals(b){P(b);let{X:m,Y:y,Z:S}=this,{X:I,Y:T,Z:_}=b,C=n.eql(n.mul(m,_),n.mul(I,S)),L=n.eql(n.mul(y,_),n.mul(T,S));return C&&L}negate(){return new w(this.X,n.neg(this.Y),this.Z)}double(){let{a:b,b:m}=s,y=n.mul(m,zn),{X:S,Y:I,Z:T}=this,_=n.ZERO,C=n.ZERO,L=n.ZERO,K=n.mul(S,S),J=n.mul(I,I),Y=n.mul(T,T),H=n.mul(S,I);return H=n.add(H,H),L=n.mul(S,T),L=n.add(L,L),_=n.mul(b,L),C=n.mul(y,Y),C=n.add(_,C),_=n.sub(J,C),C=n.add(J,C),C=n.mul(_,C),_=n.mul(H,_),L=n.mul(y,L),Y=n.mul(b,Y),H=n.sub(K,Y),H=n.mul(b,H),H=n.add(H,L),L=n.add(K,K),K=n.add(L,K),K=n.add(K,Y),K=n.mul(K,H),C=n.add(C,K),Y=n.mul(I,T),Y=n.add(Y,Y),K=n.mul(Y,H),_=n.sub(_,K),L=n.mul(Y,J),L=n.add(L,L),L=n.add(L,L),new w(_,C,L)}add(b){P(b);let{X:m,Y:y,Z:S}=this,{X:I,Y:T,Z:_}=b,C=n.ZERO,L=n.ZERO,K=n.ZERO,J=s.a,Y=n.mul(s.b,zn),H=n.mul(m,I),tt=n.mul(y,T),at=n.mul(S,_),St=n.add(m,y),et=n.add(I,T);St=n.mul(St,et),et=n.add(H,tt),St=n.sub(St,et),et=n.add(m,S);let yt=n.add(I,_);return et=n.mul(et,yt),yt=n.add(H,at),et=n.sub(et,yt),yt=n.add(y,S),C=n.add(T,_),yt=n.mul(yt,C),C=n.add(tt,at),yt=n.sub(yt,C),K=n.mul(J,et),C=n.mul(Y,at),K=n.add(C,K),C=n.sub(tt,K),K=n.add(tt,K),L=n.mul(C,K),tt=n.add(H,H),tt=n.add(tt,H),at=n.mul(J,at),et=n.mul(Y,et),tt=n.add(tt,at),at=n.sub(H,at),at=n.mul(J,at),et=n.add(et,at),H=n.mul(tt,et),L=n.add(L,H),H=n.mul(yt,et),C=n.mul(St,C),C=n.sub(C,H),H=n.mul(St,tt),K=n.mul(yt,K),K=n.add(K,H),new w(C,L,K)}subtract(b){return this.add(b.negate())}is0(){return this.equals(w.ZERO)}multiply(b){let{endo:m}=t;if(!o.isValidNot0(b))throw new Error("invalid scalar: out of range");let y,S,I=T=>U.cached(this,T,_=>ce(w,_));if(m){let{k1neg:T,k1:_,k2neg:C,k2:L}=R(b),{p:K,f:J}=I(_),{p:Y,f:H}=I(L);S=J.add(H),y=N(m.beta,K,Y,T,C)}else{let{p:T,f:_}=I(b);y=T,S=_}return ce(w,[y,S])[0]}multiplyUnsafe(b){let{endo:m}=t,y=this;if(!o.isValid(b))throw new Error("invalid scalar: out of range");if(b===he||y.is0())return w.ZERO;if(b===lr)return y;if(U.hasCache(this))return this.multiply(b);if(m){let{k1neg:S,k1:I,k2neg:T,k2:_}=R(b),{p1:C,p2:L}=Va(w,y,I,_);return N(m.beta,C,L,S,T)}else return U.unsafe(y,b)}multiplyAndAddUnsafe(b,m,y){let S=this.multiplyUnsafe(m).add(b.multiplyUnsafe(y));return S.is0()?void 0:S}toAffine(b){return F(this,b)}isTorsionFree(){let{isTorsionFree:b}=t;return i===lr?!0:b?b(w,this):U.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:b}=t;return i===lr?this:b?b(w,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(b=!0){return se(b,"isCompressed"),this.assertValidity(),p(w,this,b)}toHex(b=!0){return Rt(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(b=!0){return this.toBytes(b)}_setWindowSize(b){this.precompute(b)}static normalizeZ(b){return ce(w,b)}static msm(b,m){return or(w,o,b,m)}static fromPrivateKey(b){return w.BASE.multiply(fr(o,b))}}w.BASE=new w(s.Gx,s.Gy,n.ONE),w.ZERO=new w(n.ZERO,n.ONE,n.ZERO),w.Fp=n,w.Fn=o;let B=o.BITS,U=new nr(w,t.endo?Math.ceil(B/2):B);return w.BASE.precompute(8),w}function dc(e){return Uint8Array.of(e?2:3)}function hc(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function rd(e,t={}){let{Fn:r}=e,n=t.randomBytes||Je,o=Object.assign(hc(e.Fp,r),{seed:as(r.ORDER)});function s(p){try{return!!fr(r,p)}catch{return!1}}function i(p,h){let{publicKey:g,publicKeyUncompressed:v}=o;try{let x=p.length;return h===!0&&x!==g||h===!1&&x!==v?!1:!!e.fromBytes(p)}catch{return!1}}function c(p=n(o.seed)){return cs(Tt(p,o.seed,"seed"),r.ORDER)}function a(p,h=!0){return e.BASE.multiply(fr(r,p)).toBytes(h)}function u(p){let h=c(p);return{secretKey:h,publicKey:a(h)}}function d(p){if(typeof p=="bigint")return!1;if(p instanceof e)return!0;let{secretKey:h,publicKey:g,publicKeyUncompressed:v}=o;if(r.allowedLengths||h===g)return;let x=Z("key",p).length;return x===g||x===v}function l(p,h,g=!0){if(d(p)===!0)throw new Error("first arg must be private key");if(d(h)===!1)throw new Error("second arg must be public key");let v=fr(r,p);return e.fromHex(h).multiply(v).toBytes(g)}return Object.freeze({getPublicKey:a,getSharedSecret:l,keygen:u,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c,isValidPrivateKey:s,randomPrivateKey:c,normPrivateKeyToScalar:p=>fr(r,p),precompute(p=8,h=e.BASE){return h.precompute(p,!1)}},lengths:o})}function nd(e,t,r={}){In(t),ve(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=r.randomBytes||Je,o=r.hmac||((m,...y)=>Ws(t,m,wt(...y))),{Fp:s,Fn:i}=e,{ORDER:c,BITS:a}=i,{keygen:u,getPublicKey:d,getSharedSecret:l,utils:f,lengths:p}=rd(e,r),h={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function v(m){let y=c>>lr;return m>y}function x(m,y){if(!i.isValidNot0(y))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return y}function A(m,y){Xs(y);let S=p.signature,I=y==="compact"?S:y==="recovered"?S+1:void 0;return Tt(m,I,`${y} signature`)}class E{constructor(y,S,I){this.r=x("r",y),this.s=x("s",S),I!=null&&(this.recovery=I),Object.freeze(this)}static fromBytes(y,S=g){A(y,S);let I;if(S==="der"){let{r:L,s:K}=de.toSig(Tt(y));return new E(L,K)}S==="recovered"&&(I=y[0],S="compact",y=y.subarray(1));let T=i.BYTES,_=y.subarray(0,T),C=y.subarray(T,T*2);return new E(i.fromBytes(_),i.fromBytes(C),I)}static fromHex(y,S){return this.fromBytes(Oe(y),S)}addRecoveryBit(y){return new E(this.r,this.s,y)}recoverPublicKey(y){let S=s.ORDER,{r:I,s:T,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(c*lc<S&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");let L=_===2||_===3?I+c:I;if(!s.isValid(L))throw new Error("recovery id 2 or 3 invalid");let K=s.toBytes(L),J=e.fromBytes(wt(dc((_&1)===0),K)),Y=i.inv(L),H=R(Z("msgHash",y)),tt=i.create(-H*Y),at=i.create(T*Y),St=e.BASE.multiplyUnsafe(tt).add(J.multiplyUnsafe(at));if(St.is0())throw new Error("point at infinify");return St.assertValidity(),St}hasHighS(){return v(this.s)}toBytes(y=g){if(Xs(y),y==="der")return Oe(de.hexFromSig(this));let S=i.toBytes(this.r),I=i.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return wt(Uint8Array.of(this.recovery),S,I)}return wt(S,I)}toHex(y){return Rt(this.toBytes(y))}assertValidity(){}static fromCompact(y){return E.fromBytes(Z("sig",y),"compact")}static fromDER(y){return E.fromBytes(Z("sig",y),"der")}normalizeS(){return this.hasHighS()?new E(this.r,i.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Rt(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Rt(this.toBytes("compact"))}}let P=r.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");let S=tr(y),I=y.length*8-a;return I>0?S>>BigInt(I):S},R=r.bits2int_modN||function(y){return i.create(P(y))},F=Se(a);function V(m){return Fr("num < 2^"+a,m,he,F),i.toBytes(m)}function N(m,y){return Tt(m,void 0,"message"),y?Tt(t(m),void 0,"prehashed message"):m}function w(m,y,S){if(["recovered","canonical"].some(tt=>tt in S))throw new Error("sign() legacy options not supported");let{lowS:I,prehash:T,extraEntropy:_}=js(S,h);m=N(m,T);let C=R(m),L=fr(i,y),K=[V(L),V(C)];if(_!=null&&_!==!1){let tt=_===!0?n(p.secretKey):_;K.push(Z("extraEntropy",tt))}let J=wt(...K),Y=C;function H(tt){let at=P(tt);if(!i.isValidNot0(at))return;let St=i.inv(at),et=e.BASE.multiply(at).toAffine(),yt=i.create(et.x);if(yt===he)return;let mn=i.create(St*i.create(Y+yt*L));if(mn===he)return;let Pi=(et.x===yt?0:2)|Number(et.y&lr),Ti=mn;return I&&v(mn)&&(Ti=i.neg(mn),Pi^=1),new E(yt,Ti,Pi)}return{seed:J,k2sig:H}}function B(m,y,S={}){m=Z("message",m);let{seed:I,k2sig:T}=w(m,y,S);return Aa(t.outputLen,i.BYTES,o)(I,T)}function U(m){let y,S=typeof m=="string"||re(m),I=!S&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!S&&!I)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(I)y=new E(m.r,m.s);else if(S){try{y=E.fromBytes(Z("sig",m),"der")}catch(T){if(!(T instanceof de.Err))throw T}if(!y)try{y=E.fromBytes(Z("sig",m),"compact")}catch{return!1}}return y||!1}function D(m,y,S,I={}){let{lowS:T,prehash:_,format:C}=js(I,h);if(S=Z("publicKey",S),y=N(Z("message",y),_),"strict"in I)throw new Error("options.strict was renamed to lowS");let L=C===void 0?U(m):E.fromBytes(Z("sig",m),C);if(L===!1)return!1;try{let K=e.fromBytes(S);if(T&&L.hasHighS())return!1;let{r:J,s:Y}=L,H=R(y),tt=i.inv(Y),at=i.create(H*tt),St=i.create(J*tt),et=e.BASE.multiplyUnsafe(at).add(K.multiplyUnsafe(St));return et.is0()?!1:i.create(et.x)===J}catch{return!1}}function b(m,y,S={}){let{prehash:I}=js(S,h);return y=N(y,I),E.fromBytes(m,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:u,getPublicKey:d,getSharedSecret:l,utils:f,lengths:p,Point:e,sign:B,verify:D,recoverPublicKey:b,Signature:E,hash:t})}function od(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=Ot(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function sd(e){let{CURVE:t,curveOpts:r}=od(e),n={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,hash:e.hash,ecdsaOpts:n}}function id(e,t){let r=t.Point;return Object.assign({},t,{ProjectivePoint:r,CURVE:Object.assign({},e,On(r.Fn.ORDER,r.Fn.BITS))})}function pc(e){let{CURVE:t,curveOpts:r,hash:n,ecdsaOpts:o}=sd(e),s=ed(t,r),i=nd(s,n,o);return id(e,i)}function mc(e,t){let r=n=>pc({...e,hash:n});return{...r(t),create:r}}var ti={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},ad={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var yc=BigInt(2);function cd(e){let t=ti.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),u=e*e*e%t,d=u*u*e%t,l=j(d,r,t)*d%t,f=j(l,r,t)*d%t,p=j(f,yc,t)*u%t,h=j(p,o,t)*p%t,g=j(h,s,t)*h%t,v=j(g,c,t)*g%t,x=j(v,a,t)*v%t,A=j(x,c,t)*g%t,E=j(A,r,t)*d%t,P=j(E,i,t)*h%t,R=j(P,n,t)*u%t,F=j(R,yc,t);if(!Js.eql(Js.sqr(F),e))throw new Error("Cannot find square root");return F}var Js=Ot(ti.p,{sqrt:cd}),dr=mc({...ti,Fp:Js,lowS:!0,endo:ad},Dn);function bc(e,t,r,n){let o=Tr.digest(r instanceof Uint8Array?r:r.subarray());if(Kn(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),dr.verify(t,s,e))).catch(s=>{throw s.name==="AbortError"?s:new $r(String(s))});try{return n?.signal?.throwIfAborted(),dr.verify(t,o.digest,e)}catch(s){throw new $r(String(s))}}var $n=class{type="secp256k1";raw;_key;constructor(t){this._key=xc(t),this.raw=gc(this._key)}toMultihash(){return Kt.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){return bc(this._key,r,t,n)}};function ei(e){return new $n(e)}function gc(e){return dr.ProjectivePoint.fromHex(e).toRawBytes(!0)}function xc(e){try{return dr.ProjectivePoint.fromHex(e),e}catch(t){throw new $e(String(t))}}function hr(e,t){let{Type:r,Data:n}=Yt.decode(e),o=n??new Uint8Array;switch(r){case st.RSA:return Gs(o,t);case st.Ed25519:return xs(o);case st.secp256k1:return ei(o);case st.ECDSA:return Zo(o);default:throw new De}}function wc(e){let{Type:t,Data:r}=Yt.decode(e.digest),n=r??new Uint8Array;switch(t){case st.Ed25519:return xs(n);case st.secp256k1:return ei(n);case st.ECDSA:return Zo(n);default:throw new De}}function Gt(e){return Yt.encode({Type:st[e.type],Data:e.raw})}var Xr;(function(e){let t;e.codec=()=>(t==null&&(t=qt((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.publicKey!=null&&r.publicKey.byteLength>0&&(n.uint32(10),n.bytes(r.publicKey)),r.payloadType!=null&&r.payloadType.byteLength>0&&(n.uint32(18),n.bytes(r.payloadType)),r.payload!=null&&r.payload.byteLength>0&&(n.uint32(26),n.bytes(r.payload)),r.signature!=null&&r.signature.byteLength>0&&(n.uint32(42),n.bytes(r.signature)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={publicKey:ht(0),payloadType:ht(0),payload:ht(0),signature:ht(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.publicKey=r.bytes();break}case 2:{s.payloadType=r.bytes();break}case 3:{s.payload=r.bytes();break}case 5:{s.signature=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Ft(r,e.codec()),e.decode=(r,n)=>Vt(r,e.codec(),n)})(Xr||(Xr={}));var Gn=class extends Error{constructor(t="Invalid signature"){super(t),this.name="InvalidSignatureError"}};var Wt=class e{static createFromProtobuf=t=>{let r=Xr.decode(t),n=hr(r.publicKey);return new e({publicKey:n,payloadType:r.payloadType,payload:r.payload,signature:r.signature})};static seal=async(t,r,n)=>{if(r==null)throw new Error("Missing private key");let o=t.domain,s=t.codec,i=t.marshal(),c=Ec(o,s,i),a=await r.sign(c.subarray(),n);return new e({publicKey:r.publicKey,payloadType:s,payload:i,signature:a})};static openAndCertify=async(t,r,n)=>{let o=e.createFromProtobuf(t);if(!await o.validate(r,n))throw new Gn("Envelope signature is not valid for the given domain");return o};publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:r,payloadType:n,payload:o,signature:s}=t;this.publicKey=r,this.payloadType=n,this.payload=o,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Xr.encode({publicKey:Gt(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return t==null?!1:ut(this.marshal(),t.marshal())}async validate(t,r){let n=Ec(t,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,r)}},Ec=(e,t,r)=>{let n=k(e),o=ar(n.byteLength),s=ar(t.length),i=ar(r.length);return new ot(o,n,s,t,i,r)};var Sc=Symbol.for("nodejs.util.inspect.custom"),ud=114,Qr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[xo]=!0;toString(){return this.string==null&&(this.string=Q.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return it.createV1(ud,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ut(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ut(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Sc](){return`PeerId(${this.toString()})`}},Jr=class extends Qr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},tn=class extends Qr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},en=class extends Qr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},fd=2336,rn=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Kt.digest(k(this.url))}[Sc](){return`PeerId(${this.url})`}[xo]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return it.createV1(fd,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=M(t)),t.toString()===this.toString())}};var ld=114,vc=2336;function Ac(e){if(e.type==="Ed25519")return new tn({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new en({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Jr({multihash:e.toCID().multihash,publicKey:e});throw new De}function ri(e){if(hd(e))return new Jr({multihash:e});if(dd(e))try{let t=wc(e);if(t.type==="Ed25519")return new tn({multihash:e,publicKey:t});if(t.type==="secp256k1")return new en({multihash:e,publicKey:t})}catch{let r=M(e.digest);return new rn(new URL(r))}throw new gn("Supplied PeerID Multihash is invalid")}function Zn(e){if(e?.multihash==null||e.version==null||e.version===1&&e.code!==ld&&e.code!==vc)throw new bn("Supplied PeerID CID is invalid");if(e.code===vc){let t=M(e.multihash.digest);return new rn(new URL(t))}return ri(e.multihash)}function dd(e){return e.code===Kt.code}function hd(e){return e.code===Tr.code}function Ic(e,t){let r=(n,o)=>n.toString().localeCompare(o.toString());return e.length!==t.length?!1:(t.sort(r),e.sort(r).every((n,o)=>t[o].equals(n)))}var mt=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},pe=class extends Error{static name="ValidationError";name="ValidationError"},nn=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Yn=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var Wn=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,c=this.peekChar();if(c===void 0)return;let a=c==="0",u=2**(8*o)-1;for(;;){let d=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let f=Number.parseInt(l,t);if(!Number.isNaN(f))return f});if(d===void 0)break;if(s*=t,s+=d,s>u||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&a&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[c]=t(s.subarray(0,i));return r.set(s.subarray(0,c),16-c),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var _c=45,pd=15,pr=new Wn;function jn(e){if(!(e.length>pd))return pr.new(e).parseWith(()=>pr.readIPv4Addr())}function Xn(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>_c))return pr.new(e).parseWith(()=>pr.readIPv6Addr())}function mr(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>_c)return;let r=pr.new(e).parseWith(()=>pr.readIPAddr());if(r)return t&&r.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r}function yr(e){return!!jn(e)}function Qn(e){return!!Xn(e)}function oi(e){return t=>M(t,e)}function si(e){return t=>k(t,e)}function br(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function Ve(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function Cc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=k(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ve(n);return Jt([r,o],r.length+o.length)}function Bc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=be.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ve(n);return Jt([r,o],r.length+o.length)}function ii(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=M(t,"base32"),o=br(r);return`${n}:${o}`}var ai=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new mt("Invalid byte value in IP address");t[n]=o}),t},Dc=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=yr(r[n]),i;s&&(i=ai(r[n]),r[n]=M(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,M(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new mt("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},Pc=function(e){if(e.byteLength!==4)throw new mt("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},Tc=function(e){if(e.byteLength!==16)throw new mt("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new mt(`Invalid IPv6 address "${r}"`)}};function Oc(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new mt(`Invalid IPv6 address "${e}"`)}}var ni=Object.values(Or).map(e=>e.decoder),md=(function(){let e=ni[0].or(ni[1]);return ni.slice(2).forEach(t=>e=e.or(t)),e})();function Lc(e){return md.decode(e)}function Rc(e){return t=>e.encoder.encode(t)}function yd(e){if(parseInt(e).toString()!==e)throw new pe("Value must be an integer")}function bd(e){if(e<0)throw new pe("Value must be a positive integer, or zero")}function gd(e){return t=>{if(t>e)throw new pe(`Value must be smaller than or equal to ${e}`)}}function xd(...e){return t=>{for(let r of e)r(t)}}var on=xd(yd,bd,gd(65535));var dt=-1,ci=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new Yn(`Protocol ${t} was unknown`);return r}addProtocol(t){this.protocolsByCode.set(t.code,t),this.protocolsByName.set(t.name,t),t.aliases?.forEach(r=>{this.protocolsByName.set(r,t)})}removeProtocol(t){let r=this.protocolsByCode.get(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},Dt=new ci,Rd=[{code:4,name:"ip4",size:32,valueToBytes:ai,bytesToValue:Pc,validate:e=>{if(!yr(e))throw new pe(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Ve,bytesToValue:br,validate:on},{code:273,name:"udp",size:16,valueToBytes:Ve,bytesToValue:br,validate:on},{code:33,name:"dccp",size:16,valueToBytes:Ve,bytesToValue:br,validate:on},{code:41,name:"ip6",size:128,valueToBytes:Dc,bytesToValue:Tc,stringToValue:Oc,validate:e=>{if(!Qn(e))throw new pe(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:dt},{code:43,name:"ipcidr",size:8,bytesToValue:oi("base10"),valueToBytes:si("base10")},{code:53,name:"dns",size:dt,resolvable:!0},{code:54,name:"dns4",size:dt,resolvable:!0},{code:55,name:"dns6",size:dt,resolvable:!0},{code:56,name:"dnsaddr",size:dt,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:Ve,bytesToValue:br,validate:on},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:dt,path:!0,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:dt,bytesToValue:oi("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?si("base58btc")(e):it.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:ii,valueToBytes:Cc},{code:445,name:"onion3",size:296,bytesToValue:ii,valueToBytes:Bc},{code:446,name:"garlic64",size:dt},{code:447,name:"garlic32",size:dt},{code:448,name:"tls"},{code:449,name:"sni",size:dt},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:dt,bytesToValue:Rc(Ro),valueToBytes:Lc},{code:480,name:"http"},{code:481,name:"http-path",size:dt,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:dt}];Rd.forEach(e=>{Dt.addProtocol(e)});function Nc(e){let t=[],r=0;for(;r<e.length;){let n=Gr(e,r),o=Dt.getProtocol(n),s=Ct(n),i=Nd(o,e,r+s),c=0;i>0&&o.size===dt&&(c=Ct(i));let a=s+c+i,u={code:n,name:o.name,bytes:e.subarray(r,r+a)};if(i>0){let d=r+s+c,l=e.subarray(d,d+i);u.value=o.bytesToValue?.(l)??M(l)}t.push(u),r+=a}return t}function Uc(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=Dt.getProtocol(n.code),s=Ct(n.code),i,c=0,a=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??k(n.value),c=i.byteLength,o.size===dt&&(a=Ct(c)));let u=new Uint8Array(s+a+c),d=0;ir(n.code,u,d),d+=s,i!=null&&(o.size===dt&&(ir(c,u,d),d+=a),u.set(i,d)),n.bytes=u}r.push(n.bytes),t+=n.bytes.byteLength}return Jt(r,t)}function Kc(e){if(e.charAt(0)!=="/")throw new mt('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let c=s===e.length-1;if(i==="/"||c){let a=Dt.getProtocol(o);if(r==="protocol"){if(a.size==null||a.size===0){t.push({code:a.code,name:a.name}),n="",o="",r="protocol";continue}else if(c)throw new mt(`Component ${o} was missing value`);r="value"}else if(r==="value"){let u={code:a.code,name:a.name};if(a.size!=null&&a.size!==0){if(n==="")throw new mt(`Component ${o} was missing value`);u.value=a.stringToValue?.(n)??n}t.push(u),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new mt("Incomplete multiaddr");return t}function kc(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=Dt.getProtocol(t.code);if(r==null)throw new mt(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function Nd(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:Gr(t,r)}var Ud=Symbol.for("nodejs.util.inspect.custom"),gi=Symbol.for("@multiformats/multiaddr"),Kd=[53,54,55,56],bi=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}};function kd(e){if(e==null&&(e="/"),Vc(e))return e.getComponents();if(e instanceof Uint8Array)return Nc(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),Kc(e);if(Array.isArray(e))return e;throw new mt("Must be a string, Uint8Array, Component[], or another Multiaddr")}var ro=class e{[gi]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=kd(t),r.validate!==!1&&Md(this)}get bytes(){return this.#r==null&&(this.#r=Uc(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=kc(this.#t)),this.#e}toJSON(){return this.toString()}toOptions(){let t,r,n,o,s="";for(let{code:c,name:a,value:u}of this.#t)c===42&&(s=`%${u??""}`),Kd.includes(c)&&(r="tcp",o=443,n=`${u??""}${s}`,t=c===55?6:4),(c===6||c===273)&&(r=a==="tcp"?"tcp":"udp",o=parseInt(u??"")),(c===4||c===41)&&(r="tcp",n=`${u??""}${s}`,t=c===41?6:4);if(t==null||r==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:r,port:o}}getComponents(){return[...this.#t]}protos(){return this.#t.map(({code:t,value:r})=>{let n=Dt.getProtocol(t);return{code:t,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#t.map(({code:t})=>t)}protoNames(){return this.#t.map(({name:t})=>t)}tuples(){return this.#t.map(({code:t,value:r})=>{if(r==null)return[t];let n=Dt.getProtocol(t),o=[t];return r!=null&&o.push(n.valueToBytes?.(r)??k(r)),o})}stringTuples(){return this.#t.map(({code:t,value:r})=>r==null?[t]:[t,r])}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new nn(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}getPeerId(){try{let t=[];this.#t.forEach(({code:n,value:o})=>{n===421&&t.push([n,o]),n===290&&(t=[])});let r=t.pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?M(Q.decode(`z${n}`),"base58btc"):M(it.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let t of this.#t)if(Dt.getProtocol(t.code).path)return t.value??null;return null}equals(t){return ut(this.bytes,t.bytes)}async resolve(t){let r=this.protos().find(s=>s.resolvable);if(r==null)return[this];let n=Mc.get(r.name);if(n==null)throw new bi(`no available resolver for ${r.name}`);return(await n(this,t)).map(s=>Xt(s))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(){return!(this.#t.length!==2||this.#t[0].code!==4&&this.#t[0].code!==41||this.#t[1].code!==6&&this.#t[1].code!==273)}[Ud](){return`Multiaddr(${this.toString()})`}};function Md(e){e.getComponents().forEach(t=>{let r=Dt.getProtocol(t.code);t.value!=null&&r.validate?.(t.value)})}function Fc(e,t,r){let n=0;for(let o of e)if(!(n<t)){if(n>r)break;if(o!==255)return!1;n++}return!0}function qc(e,t,r,n){let o=0;for(let s of e)if(!(o<r)){if(o>n)break;if(s!==t[o])return!1;o++}return!0}function xi(e){switch(e.length){case qe:return e.join(".");case He:{let t=[];for(let r=0;r<e.length;r++)r%2===0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw new Error("Invalid ip length")}}function Hc(e){let t=0;for(let[r,n]of e.entries()){if(n===255){t+=8;continue}for(;(n&128)!=0;)t++,n=n<<1;if((n&128)!=0)return-1;for(let o=r+1;o<e.length;o++)if(e[o]!=0)return-1;break}return t}function zc(e){let t="0x";for(let r of e)t+=(r>>4).toString(16)+(r&15).toString(16);return t}var qe=4,He=16,Lg=parseInt("0xFFFF",16),Vd=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function fn(e,t){t.length===He&&e.length===qe&&Fc(t,0,11)&&(t=t.slice(12)),t.length===qe&&e.length===He&&qc(e,Vd,0,11)&&(e=e.slice(12));let r=e.length;if(r!=t.length)throw new Error("Failed to mask ip");let n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e[o]&t[o];return n}function $c(e,t){if(typeof t=="string"&&(t=mr(t)),t==null)throw new Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!==(t[r]&e.mask[r]))return!1;return!0}function wi(e){let[t,r]=e.split("/");if(!t||!r)throw new Error("Failed to parse given CIDR: "+e);let n=qe,o=jn(t);if(o==null&&(n=He,o=Xn(t),o==null))throw new Error("Failed to parse given CIDR: "+e);let s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+e);let i=Ei(s,8*n);return{network:fn(o,i),mask:i}}function Ei(e,t){if(t!==8*qe&&t!==8*He)throw new Error("Invalid CIDR mask");if(e<0||e>t)throw new Error("Invalid CIDR mask");let r=t/8,n=new Uint8Array(r);for(let o=0;o<r;o++){if(e>=8){n[o]=255,e-=8;continue}n[o]=255-(255>>e),e=0}return n}var vr=class{constructor(t,r){if(r==null)({network:this.network,mask:this.mask}=wi(t));else{let n=mr(t);if(n==null)throw new Error("Failed to parse network");r=String(r);let o=parseInt(r,10);if(Number.isNaN(o)||String(o).length!==r.length||o<0||o>n.length*8){let s=mr(r);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=Ei(o,8*n.length);this.network=fn(n,this.mask)}}contains(t){return $c({network:this.network,mask:this.mask},t)}toString(){let t=Hc(this.mask),r=t!==-1?String(t):zc(this.mask);return xi(this.network)+"/"+r}};function Gc(e,t){return new vr(e).contains(t)}var Mc=new Map;function Vc(e){return!!e?.[gi]}function Xt(e){return new ro(e)}function no(e){let t=Dt.getProtocol(e);return{code:t.code,size:t.size??0,name:t.name,resolvable:!!t.resolvable,path:!!t.path}}var Zc="libp2p-peer-record",Yc=Uint8Array.from([3,1]);var ln;(function(e){let t;(function(n){let o;n.codec=()=>(o==null&&(o=qt((s,i,c={})=>{c.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),c.lengthDelimited!==!1&&i.ldelim()},(s,i,c={})=>{let a={multiaddr:ht(0)},u=i==null?s.len:s.pos+i;for(;s.pos<u;){let d=s.uint32();switch(d>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(d&7);break}}}return a})),o),n.encode=s=>Ft(s,n.codec()),n.decode=(s,i)=>Vt(s,n.codec(),i)})(t=e.AddressInfo||(e.AddressInfo={}));let r;e.codec=()=>(r==null&&(r=qt((n,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let i of n.addresses)o.uint32(26),e.AddressInfo.codec().encode(i,o);s.lengthDelimited!==!1&&o.ldelim()},(n,o,s={})=>{let i={peerId:ht(0),seq:0n,addresses:[]},c=o==null?n.len:n.pos+o;for(;n.pos<c;){let a=n.uint32();switch(a>>>3){case 1:{i.peerId=n.bytes();break}case 2:{i.seq=n.uint64();break}case 3:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new Me('Decode error - map field "addresses" had too many elements');i.addresses.push(e.AddressInfo.codec().decode(n,n.uint32(),{limits:s.limits?.addresses$}));break}default:{n.skipType(a&7);break}}}return i})),r),e.encode=n=>Ft(n,e.codec()),e.decode=(n,o)=>Vt(n,e.codec(),o)})(ln||(ln={}));var Ht=class e{static createFromProtobuf=t=>{let r=ln.decode(t),n=ri(Dr(r.peerId)),o=(r.addresses??[]).map(i=>Xt(i.multiaddr)),s=r.seq;return new e({peerId:n,multiaddrs:o,seqNumber:s})};static DOMAIN=Zc;static CODEC=Yc;peerId;multiaddrs;seqNumber;domain=e.DOMAIN;codec=e.CODEC;marshaled;constructor(t){let{peerId:r,multiaddrs:n,seqNumber:o}=t;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=o??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=ln.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof e)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!Ic(this.multiaddrs,t.multiaddrs))}};function Wc(e,t){let r,n=function(){let o=function(){r=void 0,e()};clearTimeout(r),r=setTimeout(o,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}function Fd(e){return e[Symbol.asyncIterator]!=null}function qd(e){if(Fd(e))return(async()=>{for await(let t of e);})();for(let t of e);}var jc=qd;function zt(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var oo=globalThis.CustomEvent??Event;async function*Si(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);let n=t.ordered??!1,o=new EventTarget,s=[],i=zt(),c=zt(),a=!1,u,d=!1;o.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(async()=>{try{for await(let h of e){if(s.length===r&&(i=zt(),await i.promise),d)break;let g={done:!1};s.push(g),h().then(v=>{g.done=!0,g.ok=!0,g.value=v,o.dispatchEvent(new oo("task-complete"))},v=>{g.done=!0,g.err=v,o.dispatchEvent(new oo("task-complete"))})}a=!0,o.dispatchEvent(new oo("task-complete"))}catch(h){u=h,o.dispatchEvent(new oo("task-complete"))}});function l(){return n?s[0]?.done:!!s.find(h=>h.done)}function*f(){for(;s.length>0&&s[0].done;){let h=s[0];if(s.shift(),h.ok)yield h.value;else throw d=!0,i.resolve(),h.err;i.resolve()}}function*p(){for(;l();)for(let h=0;h<s.length;h++)if(s[h].done){let g=s[h];if(s.splice(h,1),h--,g.ok)yield g.value;else throw d=!0,i.resolve(),g.err;i.resolve()}}for(;;){if(l()||(c=zt(),await c.promise),u!=null||(n?yield*f():yield*p(),u!=null))throw u;if(a&&s.length===0)break}}var so=class extends Error{type;code;constructor(t,r,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=r??"ABORT_ERR"}};async function dn(e,t,r){if(t==null)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new so(r?.errorMessage,r?.errorCode,r?.errorName));let n,o=new so(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var vi=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=zt(),this.haveNext=zt()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=zt(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,r){await this._push(t,r)}async end(t,r){t!=null?await this.throw(t):await this._push(void 0,r)}async _push(t,r){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=zt(),await dn(this.readNext.promise,r?.signal,r)}};function Xc(){return new vi}var io=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Qc(e,t){let r=Xc();e.sink(r).catch(async i=>{await r.end(i)}),e.sink=async i=>{for await(let c of i)await r.push(c);await r.end()};let n=e.source;e.source[Symbol.iterator]!=null?n=e.source[Symbol.iterator]():e.source[Symbol.asyncIterator]!=null&&(n=e.source[Symbol.asyncIterator]());let o=new ot;return{read:async i=>{if(i?.signal?.throwIfAborted(),i?.bytes==null){let{done:a,value:u}=await dn(n.next(),i?.signal);return a===!0?null:u}for(;o.byteLength<i.bytes;){let{value:a,done:u}=await dn(n.next(),i?.signal);if(u===!0)throw new io("unexpected end of input");o.append(a)}let c=o.sublist(0,i.bytes);return o.consume(i.bytes),c},write:async(i,c)=>{c?.signal?.throwIfAborted(),i instanceof Uint8Array?await r.push(i,c):await r.push(i.subarray(),c)},unwrap:()=>{if(o.byteLength>0){let i=e.source;e.source=(async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i})()}return e}}}var ao=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},co=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},uo=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Jc(e,t={}){let r=Qc(e,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=Ct(t.maxDataLength));let n=t?.lengthDecoder??Gr,o=t?.lengthEncoder??ar;return{read:async i=>{let c=-1,a=new ot;for(;;){a.append(await r.read({...i,bytes:1}));try{c=n(a)}catch(u){if(u instanceof RangeError)continue;throw u}if(c<0)throw new ao("Invalid message length");if(t?.maxLengthLength!=null&&a.byteLength>t.maxLengthLength)throw new uo("message length length too long");if(c>-1)break}if(t?.maxDataLength!=null&&c>t.maxDataLength)throw new co("message length too long");return r.read({...i,bytes:c})},write:async(i,c)=>{await r.write(new ot(o(i.byteLength),i),c)},writeV:async(i,c)=>{let a=new ot(...i.flatMap(u=>[o(u.byteLength),u]));await r.write(a,c)},unwrap:()=>r.unwrap()}}function Ar(e,t){let r=Jc(e,t),n={read:async(o,s)=>{let i=await r.read(s);return o.decode(i)},write:async(o,s,i)=>{await r.write(s.encode(o),i)},writeV:async(o,s,i)=>{await r.writeV(o.map(c=>s.encode(c)),i)},pb:o=>({read:async s=>n.read(o,s),write:async(s,i)=>n.write(s,o,i),writeV:async(s,i)=>n.writeV(s,o,i),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}var tu="0.1.0";var eu="id/push",ru="1.0.0",nu="1.0.0";var Be;(function(e){let t;e.codec=()=>(t==null&&(t=qt((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.protocolVersion!=null&&(n.uint32(42),n.string(r.protocolVersion)),r.agentVersion!=null&&(n.uint32(50),n.string(r.agentVersion)),r.publicKey!=null&&(n.uint32(10),n.bytes(r.publicKey)),r.listenAddrs!=null)for(let s of r.listenAddrs)n.uint32(18),n.bytes(s);if(r.observedAddr!=null&&(n.uint32(34),n.bytes(r.observedAddr)),r.protocols!=null)for(let s of r.protocols)n.uint32(26),n.string(s);r.signedPeerRecord!=null&&(n.uint32(66),n.bytes(r.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={listenAddrs:[],protocols:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 5:{s.protocolVersion=r.string();break}case 6:{s.agentVersion=r.string();break}case 1:{s.publicKey=r.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&s.listenAddrs.length===o.limits.listenAddrs)throw new Me('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(r.bytes());break}case 4:{s.observedAddr=r.bytes();break}case 3:{if(o.limits?.protocols!=null&&s.protocols.length===o.limits.protocols)throw new Me('Decode error - map field "protocols" had too many elements');s.protocols.push(r.string());break}case 8:{s.signedPeerRecord=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Ft(r,e.codec()),e.decode=(r,n)=>Vt(r,e.codec(),n)})(Be||(Be={}));var Pt={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function ou(e){if(e!=null&&e.length>0)try{return Xt(e)}catch{}}function $d(e,t){return t??e.userAgent}async function fo(e,t,r,n,o){if(r("received identify from %p",n.remotePeer),o==null)throw new Ut("message was null or undefined");let s={};if(o.listenAddrs.length>0&&(s.addresses=o.listenAddrs.map(a=>({isCertified:!1,multiaddr:Xt(a)}))),o.protocols.length>0&&(s.protocols=o.protocols),o.publicKey!=null){let a=hr(o.publicKey);if(!Ac(a).equals(n.remotePeer))throw new Ut("public key did not match remote PeerId");s.publicKey=a}let i;if(o.signedPeerRecord!=null){r.trace("received signedPeerRecord from %p",n.remotePeer);let a=o.signedPeerRecord,u=await Wt.openAndCertify(a,Ht.DOMAIN),d=Ht.createFromProtobuf(u.payload),l=Zn(u.publicKey.toCID());if(!d.peerId.equals(l))throw new Ut("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(d.peerId))throw new Ut("signing key does not match remote PeerId");let f;try{f=await e.get(d.peerId)}catch(p){if(p.name!=="NotFoundError")throw p}if(f!=null&&(s.metadata=f.metadata,f.peerRecordEnvelope!=null)){let p=Wt.createFromProtobuf(f.peerRecordEnvelope),h=Ht.createFromProtobuf(p.payload);h.seqNumber>=d.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",h.seqNumber,d.seqNumber),d=h,a=f.peerRecordEnvelope)}s.peerRecordEnvelope=a,s.addresses=d.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),i={seq:d.seqNumber,addresses:d.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,s),await e.patch(n.remotePeer,s),o.agentVersion!=null||o.protocolVersion!=null){let a={};o.agentVersion!=null&&(a.AgentVersion=k(o.agentVersion)),o.protocolVersion!=null&&(a.ProtocolVersion=k(o.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,a),await e.merge(n.remotePeer,{metadata:a})}let c={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(a=>Xt(a)),observedAddr:o.observedAddr==null?void 0:Xt(o.observedAddr),protocols:o.protocols,signedPeerRecord:i,connection:n};return t.safeDispatchEvent("peer:identify",{detail:c}),c}var Ir=class{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(t,r){this.protocol=r.protocol,this.started=!1,this.peerId=t.peerId,this.privateKey=t.privateKey,this.peerStore=t.peerStore,this.registrar=t.registrar,this.addressManager=t.addressManager,this.events=t.events,this.log=r.log,this.timeout=r.timeout??Pt.timeout,this.maxInboundStreams=r.maxInboundStreams??Pt.maxInboundStreams,this.maxOutboundStreams=r.maxOutboundStreams??Pt.maxOutboundStreams,this.maxMessageSize=r.maxMessageSize??Pt.maxMessageSize,this.maxObservedAddresses=r.maxObservedAddresses??Pt.maxObservedAddresses,this.runOnLimitedConnection=r.runOnLimitedConnection??Pt.runOnLimitedConnection,this.host={protocolVersion:`${r.protocolPrefix??Pt.protocolPrefix}/${tu}`,agentVersion:$d(t.nodeInfo,r.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:k(this.host.agentVersion),ProtocolVersion:k(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,t=>{this.handleProtocol(t).catch(r=>{this.log.error(r)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}};var lo=class extends Ir{connectionManager;concurrency;_push;constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??Pt.protocolPrefix}/${eu}/${nu}`,log:t.logger.forComponent("libp2p:identify-push")}),this.connectionManager=t.connectionManager,this.concurrency=r.concurrency??Pt.concurrency,this._push=Wc(this.sendPushMessage.bind(this),r.debounce??1e3),(r.runOnSelfUpdate??Pt.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error("error pushing updates to peers - %e",o)})})}[wn]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{let t=this.addressManager.getAddresses().map(d=>d.decapsulateCode(no("p2p").code)),r=new Ht({peerId:this.peerId,multiaddrs:t}),n=await Wt.seal(r,this.privateKey),o=this.registrar.getProtocols(),s=await this.peerStore.get(this.peerId),i=M(s.metadata.get("AgentVersion")??k(this.host.agentVersion)),c=M(s.metadata.get("ProtocolVersion")??k(this.host.protocolVersion)),a=this;async function*u(){for(let d of a.connectionManager.getConnections()){let l=await a.peerStore.get(d.remotePeer),f=d.log.newScope("identify-push");l.protocols.includes(a.protocol)&&(yield async()=>{let p,h=AbortSignal.timeout(a.timeout);try{p=await d.newStream(a.protocol,{signal:h,runOnLimitedConnection:a.runOnLimitedConnection}),await Ar(p,{maxDataLength:a.maxMessageSize}).pb(Be).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:i,protocolVersion:c},{signal:h}),await p.close({signal:h})}catch(g){f.error("could not push identify update to peer",g),p?.abort(g)}})}}await jc(Si(u(),{concurrency:this.concurrency}))}catch(t){this.log.error("error pushing updates to peers - %e",t)}}async handleProtocol(t){let{connection:r,stream:n}=t,o=r.log.newScope("identify-push");try{if(this.peerId.equals(r.remotePeer))throw new Error("received push from ourselves?");let s={signal:AbortSignal.timeout(this.timeout)},c=await Ar(n,{maxDataLength:this.maxMessageSize}).pb(Be).read(s);await n.close(s),await fo(this.peerStore,this.events,o,r,c)}catch(s){o.error("received invalid message",s),n.abort(s);return}o.trace("handled push from %p",r.remotePeer)}};function su(e){try{for(let{code:t,value:r}of e.getComponents())if(r!=null&&t===41)return Gc("2000::/3",r)}catch{}return!1}var au=Iu(iu(),1),Zd=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],Yd=Zd.map(e=>new au.Netmask(e));function Ai(e){for(let t of Yd)if(t.contains(e))return!0;return!1}function Wd(e){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)}function jd(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`;return Ai(o)}function Xd(e){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)}function Qd(e){let t=e.split(":"),r=t[t.length-1];return Ai(r)}function Jd(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}function cu(e){if(yr(e))return Ai(e);if(Wd(e))return jd(e);if(Xd(e))return Qd(e);if(Qn(e))return Jd(e)}function uu(e){try{for(let{code:t}of e.getComponents())if(t!==42)return t===4||t===41}catch{}return!1}function fu(e){try{if(!uu(e))return!1;let[[,t]]=e.stringTuples();return t==null?!1:cu(t)??!1}catch{}return!0}var X=e=>({match:t=>{let r=t[0];return r==null||r.code!==e||r.value!=null?!1:t.slice(1)}}),O=(e,t)=>({match:r=>{let n=r[0];return n?.code!==e||n.value==null||t!=null&&n.value!==t?!1:r.slice(1)}}),q=e=>({match:t=>{let r=e.match(t);return r===!1?t:r}}),xt=(...e)=>({match:t=>{let r;for(let n of e){let o=n.match(t);o!==!1&&(r==null||o.length<r.length)&&(r=o)}return r??!1}}),G=(...e)=>({match:t=>{for(let r of e){let n=r.match(t);if(n===!1)return!1;t=n}return t}});function W(...e){function t(o){if(o==null)return!1;let s=o.getComponents();for(let i of e){let c=i.match(s);if(c===!1)return!1;s=c}return s}function r(o){return t(o)!==!1}function n(o){let s=t(o);return s===!1?!1:s.length===0}return{matchers:e,matches:r,exactMatch:n}}var th=O(421),Lw=W(th),po=O(54),mo=O(55),yo=O(56),_i=O(53),Rw=W(po,q(O(421))),Nw=W(mo,q(O(421))),Uw=W(yo,q(O(421))),Kw=W(xt(_i,yo,po,mo),q(O(421))),lu=G(O(4),q(O(43))),du=G(q(O(42)),O(41),q(O(43))),Ci=xt(lu,du),ze=xt(Ci,_i,po,mo,yo),hu=W(xt(Ci,G(xt(_i,yo,po,mo),q(O(421))))),kw=W(lu),Mw=W(du),Vw=W(Ci),Bi=G(ze,O(6)),pn=G(ze,O(273)),pu=W(G(Bi,q(O(421)))),Fw=W(pn),Di=G(pn,X(460),q(O(421))),bo=G(pn,X(461),q(O(421))),eh=xt(Di,bo),qw=W(Di),Hw=W(bo),Ii=xt(ze,Bi,pn,Di,bo),mu=xt(G(Ii,X(477),q(O(421)))),zw=W(mu),yu=xt(G(Ii,X(478),q(O(421))),G(Ii,X(448),q(O(449)),X(477),q(O(421)))),$w=W(yu),bu=G(pn,X(280),q(O(466)),q(O(466)),q(O(421))),Gw=W(bu),gu=G(bo,X(465),q(O(466)),q(O(466)),q(O(421))),Zw=W(gu),ho=xt(mu,yu,G(Bi,q(O(421))),G(eh,q(O(421))),G(ze,q(O(421))),bu,gu,O(421)),Yw=W(ho),rh=G(ho,X(290),O(421)),Ww=W(rh),nh=xt(G(ho,X(290),X(281),q(O(421))),G(ho,X(281),q(O(421))),G(X(281),q(O(421)))),jw=W(nh),oh=xt(G(ze,O(6),X(480),q(O(421))),G(ze,X(480),q(O(421)))),Xw=W(oh),sh=G(ze,xt(G(O(6,"443"),X(480)),G(O(6),X(443)),G(O(6),X(448),X(480)),G(X(448),X(480)),X(448),X(443)),q(O(421))),Qw=W(sh),ih=xt(G(O(777),q(O(421)))),Jw=W(ih),ah=xt(G(O(400),q(O(421)))),t2=W(ah);var go=class extends Ir{constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??Pt.protocolPrefix}/${"id"}/${ru}`,log:t.logger.forComponent("libp2p:identify")}),(r.runOnConnectionOpen??Pt.runOnConnectionOpen)&&t.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(s=>{s.name!==xn.name&&this.log.error("error during identify trigged by connection:open",s)})})}[wn]=["@libp2p/identify"];async _identify(t,r={}){let n;if(r.signal==null){let o=AbortSignal.timeout(this.timeout);r={...r,signal:o}}try{n=await t.newStream(this.protocol,{...r,runOnLimitedConnection:this.runOnLimitedConnection});let s=await Ar(n,{maxDataLength:this.maxMessageSize}).pb(Be).read(r);return await n.close(r),s}catch(o){throw n?.abort(o),o}}async identify(t,r={}){let n=await this._identify(t,r),{publicKey:o,protocols:s,observedAddr:i}=n;if(o==null)throw new Ut("Public key was missing from identify message");let c=hr(o),a=Zn(c.toCID()),u=t.log.newScope("identify");if(!t.remotePeer.equals(a))throw new Ut("Identified peer does not match the expected peer");if(this.peerId.equals(a))throw new Ut("Identified peer is our own peer id?");return this.maybeAddObservedAddress(i,u),u("completed for peer %p and protocols %o",a,s),fo(this.peerStore,this.events,u,t,n)}maybeAddObservedAddress(t,r){let n=ou(t);if(n==null)return;if(r.trace("our observed address was %a",n),fu(n)){this.log.trace("our observed address was private");return}let o=n.getComponents();if((o[0].code===41||o[0].code===42&&o[1].code===41)&&!su(n)){r.trace("our observed address was IPv6 but not a global unicast address");return}pu.exactMatch(n)||(r.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){let{connection:r,stream:n}=t,o=r.log.newScope("identify"),s=AbortSignal.timeout(this.timeout);try{let i=await this.peerStore.get(this.peerId),c=this.addressManager.getAddresses().map(l=>l.decapsulateCode(no("p2p").code)),a=i.peerRecordEnvelope;if(c.length>0&&a==null){let l=new Ht({peerId:this.peerId,multiaddrs:c});a=(await Wt.seal(l,this.privateKey)).marshal().subarray()}let u=r.remoteAddr.bytes;hu.matches(r.remoteAddr)||(u=void 0),await Ar(n).pb(Be).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Gt(this.privateKey.publicKey),listenAddrs:c.map(l=>l.bytes),signedPeerRecord:a,observedAddr:u,protocols:i.protocols},{signal:s}),await n.close({signal:s})}catch(i){o.error("could not respond to identify request",i),n.abort(i)}}};function uh(e={}){return t=>new go(t,e)}function fh(e={}){return t=>new lo(t,e)}return _u(lh);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PIdentify}));
//# sourceMappingURL=index.min.js.map
